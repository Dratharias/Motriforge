graph TB
    %% ===== AUTHENTICATION CONTEXT =====
    subgraph AuthContext ["ğŸ” Authentication Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph AuthApplicationLayer ["Application Service Layer <<Application>>"]
            AuthApplicationService["ğŸ” Authentication Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph AuthCommands ["Commands"]
                LoginCmd["ğŸ”‘ Login<br/><<Command>>"]
                LogoutCmd["ğŸšª Logout<br/><<Command>>"]
                RefreshTokenCmd["ğŸ”„ Refresh Token<br/><<Command>>"]
                ChangePasswordCmd["ğŸ”’ Change Password<br/><<Command>>"]
                ResetPasswordCmd["ğŸ”„ Reset Password<br/><<Command>>"]
                EnableMFACmd["ğŸ“± Enable MFA<br/><<Command>>"]
                DisableMFACmd["ğŸ“µ Disable MFA<br/><<Command>>"]
                RegisterDeviceCmd["ğŸ“± Register Device<br/><<Command>>"]
                RevokeTokenCmd["âŒ Revoke Token<br/><<Command>>"]
                OAuth2LoginCmd["ğŸ”— OAuth2 Login<br/><<Command>>"]
            end
            
            %% Queries
            subgraph AuthQueries ["Queries"]
                ValidateTokenQuery["âœ… Validate Token<br/><<Query>>"]
                GetSessionQuery["ğŸ”‘ Get Session<br/><<Query>>"]
                GetActiveSessionsQuery["ğŸ“‹ Get Active Sessions<br/><<Query>>"]
                GetLoginHistoryQuery["ğŸ“… Get Login History<br/><<Query>>"]
                CheckPermissionQuery["ğŸ›¡ï¸ Check Permission<br/><<Query>>"]
                GetMFAStatusQuery["ğŸ“± Get MFA Status<br/><<Query>>"]
                GetDeviceTokensQuery["ğŸ“± Get Device Tokens<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph AuthSagas ["Sagas"]
                LoginSaga["ğŸ”‘ Login<br/><<Saga>>"]
                PasswordResetSaga["ğŸ”„ Password Reset<br/><<Saga>>"]
                AccountLockoutSaga["ğŸ”’ Account Lockout<br/><<Saga>>"]
                SessionTimeoutSaga["â° Session Timeout<br/><<Saga>>"]
                SecurityAlertSaga["ğŸš¨ Security Alert<br/><<Saga>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph AuthDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            AuthSession["ğŸ”‘ Authentication Session<br/><<AggregateRoot>>"]
            UserCredentials["ğŸ”’ User Credentials<br/><<AggregateRoot>>"]
            
            %% Entities
            RefreshToken["ğŸ« Refresh Token<br/><<Entity>>"]
            DeviceToken["ğŸ“± Device Token<br/><<Entity>>"]
            AuthAttempt["ğŸ” Authentication Attempt<br/><<Entity>>"]
            Contact["ğŸ“ Contact<br/><<Entity>>"]
            
            %% Value Objects
            SessionId["ğŸ†” Session ID<br/><<ValueObject>>"]
            Password["ğŸ”’ Password<br/><<ValueObject>>"]
            TokenClaims["ğŸ“‹ Token Claims<br/><<ValueObject>>"]
            DeviceFingerprint["ğŸ‘† Device Fingerprint<br/><<ValueObject>>"]
            IPAddress["ğŸŒ IP Address<br/><<ValueObject>>"]
            
            %% Domain Services
            AuthenticationService["ğŸ” Authentication<br/><<DomainService>>"]
            AuthorizationService["ğŸ›¡ï¸ Authorization<br/><<DomainService>>"]
            TokenService["ğŸ« Token<br/><<DomainService>>"]
            SessionService["ğŸ”‘ Session<br/><<DomainService>>"]
            SecurityService["ğŸ”’ Security<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph AuthPorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            ISessionRepo["ğŸ”‘ ISessionRepository<br/><<Port>>"]
            ITokenRepo["ğŸ« ITokenRepository<br/><<Port>>"]
            IDeviceTokenRepo["ğŸ“± IDeviceTokenRepository<br/><<Port>>"]
            IAttemptRepo["ğŸ” IAttemptRepository<br/><<Port>>"]
            
            %% Service Ports
            IPasswordHasher["ğŸ” IPasswordHasher<br/><<Port>>"]
            ITokenGenerator["ğŸ« ITokenGenerator<br/><<Port>>"]
            IOAuth2Provider["ğŸ”— IOAuth2Provider<br/><<Port>>"]
            IMFAProvider["ğŸ“± IMFAProvider<br/><<Port>>"]
            IRateLimiter["â±ï¸ IRateLimiter<br/><<Port>>"]
            ISecurityLogger["ğŸ“‹ ISecurityLogger<br/><<Port>>"]
            IUserService["ğŸ‘¤ IUserService<br/><<Port>>"]
            INotificationService["ğŸ”” INotificationService<br/><<Port>>"]
            IIdentityService["ğŸ†” IIdentityService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph AuthAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph AuthRepositoryAdapters ["Repository Adapters"]
                RedisSessionRepo["ğŸ”´ Redis Session Repository<br/><<RepositoryAdapter>>"]
                RedisTokenRepo["ğŸ”´ Redis Token Repository<br/><<RepositoryAdapter>>"]
                MongoDeviceTokenRepo["ğŸ—„ï¸ Mongo Device Token Repository<br/><<RepositoryAdapter>>"]
                MongoAttemptRepo["ğŸ—„ï¸ Mongo Attempt Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph AuthServiceAdapters ["Service Adapters"]
                BcryptPasswordHasher["ğŸ” Bcrypt Password Hasher<br/><<SecurityAdapter>>"]
                JwtTokenGenerator["ğŸ« JWT Token Generator<br/><<SecurityAdapter>>"]
                GoogleOAuth2Adapter["ğŸ”— Google OAuth2<br/><<OAuth2Adapter>>"]
                Auth0MFAAdapter["ğŸ“± Auth0 MFA<br/><<MFAAdapter>>"]
                RedisRateLimiter["â±ï¸ Redis Rate Limiter<br/><<SecurityAdapter>>"]
                AuditSecurityLogger["ğŸ“‹ Audit Security Logger<br/><<LoggingAdapter>>"]
                UserContextAdapter["ğŸ‘¤ User Context<br/><<ContextAdapter>>"]
                FCMNotificationAdapter["ğŸ“± FCM Notification<br/><<NotificationAdapter>>"]
                IdentityContextAdapter["ğŸ†” Identity Context<br/><<ContextAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph AuthCacheAdapters ["Cache Adapters"]
                SessionCache["ğŸ’¾ Session Cache<br/><<CacheAdapter>>"]
                PermissionCache["ğŸ’¾ Permission Cache<br/><<CacheAdapter>>"]
                RateLimitCache["ğŸ’¾ Rate Limit Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph AuthContextBus ["Context Bus Interfaces"]
            AuthCommandBus["âš¡ Auth Command Bus<br/><<CommandBus>>"]
            AuthQueryBus["â“ Auth Query Bus<br/><<QueryBus>>"]
            AuthEventBus["ğŸ“¨ Auth Event Bus<br/><<EventBus>>"]
        end
        
        %% ===== POLICY ENFORCEMENT =====
        subgraph AuthPolicyLayer ["Policy Enforcement Layer"]
            AuthPolicyEnforcementPoint["ğŸ›¡ï¸ Auth Policy Enforcement Point<br/><<PEP>>"]
            SecurityPolicyDecisionPoint["ğŸ¯ Security Policy Decision Point<br/><<PDP>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph AuthExternal ["ğŸŒ External Systems"]
        RedisCache["ğŸ”´ Redis<br/><<Cache>>"]
        MongoDB["ğŸ—„ï¸ MongoDB<br/><<Database>>"]
        GoogleOAuth2API["ğŸ”— Google OAuth2 API<br/><<OAuth2Service>>"]
        Auth0API["ğŸ“± Auth0 API<br/><<MFAService>>"]
        FCMService["ğŸ“± FCM Service<br/><<NotificationService>>"]
        AuditLogService["ğŸ“‹ Audit Log Service<br/><<LoggingService>>"]
        EmailService["ğŸ“§ Email Service<br/><<EmailService>>"]
        SMSService["ğŸ“± SMS Service<br/><<SMSService>>"]
    end
    
    %% ===== EVENTS =====
    subgraph AuthEvents ["ğŸ“¨ Domain Events"]
        UserLoggedInEvent["ğŸ”‘ User Logged In<br/><<DomainEvent>>"]
        UserLoggedOutEvent["ğŸšª User Logged Out<br/><<DomainEvent>>"]
        PasswordChangedEvent["ğŸ”’ Password Changed<br/><<DomainEvent>>"]
        PasswordResetRequestedEvent["ğŸ”„ Password Reset Requested<br/><<DomainEvent>>"]
        MFAEnabledEvent["ğŸ“± MFA Enabled<br/><<DomainEvent>>"]
        MFADisabledEvent["ğŸ“µ MFA Disabled<br/><<DomainEvent>>"]
        DeviceRegisteredEvent["ğŸ“± Device Registered<br/><<DomainEvent>>"]
        TokenRevokedEvent["âŒ Token Revoked<br/><<DomainEvent>>"]
        LoginFailedEvent["âŒ Login Failed<br/><<DomainEvent>>"]
        AccountLockedEvent["ğŸ”’ Account Locked<br/><<DomainEvent>>"]
        SuspiciousActivityEvent["ğŸš¨ Suspicious Activity<br/><<DomainEvent>>"]
        SessionExpiredEvent["â° Session Expired<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph AuthReadModels ["ğŸ“Š Read Models"]
        ActiveSessionsRM["ğŸ”‘ Active Sessions<br/><<ReadModel>>"]
        LoginHistoryRM["ğŸ“… Login History<br/><<ReadModel>>"]
        SecurityDashboardRM["ğŸš¨ Security Dashboard<br/><<ReadModel>>"]
        DeviceListRM["ğŸ“± Device List<br/><<ReadModel>>"]
        AuthStatsRM["ğŸ“Š Authentication Stats<br/><<ReadModel>>"]
        FailedAttemptsRM["âŒ Failed Attempts<br/><<ReadModel>>"]
        SecurityAlertsRM["ğŸš¨ Security Alerts<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["ğŸŒ External Contexts"]
        UserContext["ğŸ‘¤ User Context<br/><<ExternalContext>>"]
        IdentityContext["ğŸ†” Identity Context<br/><<ExternalContext>>"]
        NotificationContext["ğŸ”” Notification Context<br/><<ExternalContext>>"]
        OrganizationContext["ğŸ¢ Organization Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    AuthApplicationService --> AuthCommandBus
    AuthApplicationService --> AuthQueryBus
    AuthApplicationService --> AuthEventBus
    
    %% Commands and Queries through Application Service
    AuthCommands --> AuthApplicationService
    AuthQueries --> AuthApplicationService
    AuthSagas --> AuthApplicationService
    
    %% Application Service to Domain (orchestration)
    AuthApplicationService --> AuthSession
    AuthApplicationService --> UserCredentials
    AuthApplicationService --> AuthenticationService
    AuthApplicationService --> AuthorizationService
    AuthApplicationService --> SecurityService
    
    %% Policy Enforcement Integration
    AuthApplicationService --> AuthPolicyEnforcementPoint
    AuthPolicyEnforcementPoint --> SecurityPolicyDecisionPoint
    
    %% Domain to Ports (Dependency Inversion)
    AuthSession -->|uses| ISessionRepo
    AuthSession -->|uses| ITokenGenerator
    AuthSession -->|uses| IRateLimiter
    UserCredentials -->|uses| IPasswordHasher
    UserCredentials -->|uses| ISecurityLogger
    TokenService -->|uses| ITokenRepo
    AuthenticationService -->|uses| IOAuth2Provider
    AuthenticationService -->|uses| IMFAProvider
    SecurityService -->|uses| IUserService
    SecurityService -->|uses| INotificationService
    SecurityService -->|uses| IIdentityService
    
    %% Ports to Adapters (Implementation)
    ISessionRepo -.->|implements| RedisSessionRepo
    ITokenRepo -.->|implements| RedisTokenRepo
    IDeviceTokenRepo -.->|implements| MongoDeviceTokenRepo
    IAttemptRepo -.->|implements| MongoAttemptRepo
    IPasswordHasher -.->|implements| BcryptPasswordHasher
    ITokenGenerator -.->|implements| JwtTokenGenerator
    IOAuth2Provider -.->|implements| GoogleOAuth2Adapter
    IMFAProvider -.->|implements| Auth0MFAAdapter
    IRateLimiter -.->|implements| RedisRateLimiter
    ISecurityLogger -.->|implements| AuditSecurityLogger
    IUserService -.->|implements| UserContextAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    IIdentityService -.->|implements| IdentityContextAdapter
    
    %% Adapters to External Systems
    RedisSessionRepo -->|connects| RedisCache
    RedisTokenRepo -->|connects| RedisCache
    MongoDeviceTokenRepo -->|connects| MongoDB
    MongoAttemptRepo -->|connects| MongoDB
    SessionCache -->|connects| RedisCache
    PermissionCache -->|connects| RedisCache
    RateLimitCache -->|connects| RedisCache
    GoogleOAuth2Adapter -->|connects| GoogleOAuth2API
    Auth0MFAAdapter -->|connects| Auth0API
    RedisRateLimiter -->|connects| RedisCache
    AuditSecurityLogger -->|connects| AuditLogService
    FCMNotificationAdapter -->|connects| FCMService
    FCMNotificationAdapter -->|also uses| EmailService
    FCMNotificationAdapter -->|also uses| SMSService
    
    %% Cross-Context Communication
    UserContextAdapter -.->|async calls| UserContext
    IdentityContextAdapter -.->|async calls| IdentityContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    
    %% Domain Events
    AuthSession -.->|publishes| UserLoggedInEvent
    AuthSession -.->|publishes| UserLoggedOutEvent
    AuthSession -.->|publishes| SessionExpiredEvent
    UserCredentials -.->|publishes| PasswordChangedEvent
    UserCredentials -.->|publishes| PasswordResetRequestedEvent
    UserCredentials -.->|publishes| MFAEnabledEvent
    UserCredentials -.->|publishes| MFADisabledEvent
    DeviceToken -.->|publishes| DeviceRegisteredEvent
    RefreshToken -.->|publishes| TokenRevokedEvent
    AuthAttempt -.->|publishes| LoginFailedEvent
    SecurityService -.->|publishes| AccountLockedEvent
    SecurityService -.->|publishes| SuspiciousActivityEvent
    
    %% Event to Read Models (via Event Bus)
    AuthEventBus -.->|projects to| ActiveSessionsRM
    AuthEventBus -.->|projects to| LoginHistoryRM
    AuthEventBus -.->|projects to| SecurityDashboardRM
    AuthEventBus -.->|projects to| DeviceListRM
    AuthEventBus -.->|projects to| AuthStatsRM
    AuthEventBus -.->|projects to| FailedAttemptsRM
    AuthEventBus -.->|projects to| SecurityAlertsRM
    
    %% Events to Event Bus
    UserLoggedInEvent -.->|publishes to| AuthEventBus
    UserLoggedOutEvent -.->|publishes to| AuthEventBus
    PasswordChangedEvent -.->|publishes to| AuthEventBus
    PasswordResetRequestedEvent -.->|publishes to| AuthEventBus
    MFAEnabledEvent -.->|publishes to| AuthEventBus
    MFADisabledEvent -.->|publishes to| AuthEventBus
    DeviceRegisteredEvent -.->|publishes to| AuthEventBus
    TokenRevokedEvent -.->|publishes to| AuthEventBus
    LoginFailedEvent -.->|publishes to| AuthEventBus
    AccountLockedEvent -.->|publishes to| AuthEventBus
    SuspiciousActivityEvent -.->|publishes to| AuthEventBus
    SessionExpiredEvent -.->|publishes to| AuthEventBus
    
    %% Sagas listen to events
    LoginSaga -.->|listens to| UserLoggedInEvent
    LoginSaga -.->|listens to| LoginFailedEvent
    PasswordResetSaga -.->|listens to| PasswordResetRequestedEvent
    AccountLockoutSaga -.->|listens to| LoginFailedEvent
    SessionTimeoutSaga -.->|listens to| SessionExpiredEvent
    SecurityAlertSaga -.->|listens to| SuspiciousActivityEvent
    
    %% Context Bus to External Event Bus
    AuthEventBus -.->|integrates with| ExternalContexts
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef externalContext fill:#f5f5f5,stroke:#757575,stroke-width:2px,stroke-dasharray: 5 5
    classDef applicationService fill:#e3f2fd,stroke:#0277bd,stroke-width:4px
    classDef contextBus fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    
    class AuthSession,UserCredentials aggregate
    class RefreshToken,DeviceToken,AuthAttempt,Contact entity
    class SessionId,Password,TokenClaims,DeviceFingerprint,IPAddress valueObject
    class ISessionRepo,ITokenRepo,IDeviceTokenRepo,IAttemptRepo,IPasswordHasher,ITokenGenerator,IOAuth2Provider,IMFAProvider,IRateLimiter,ISecurityLogger,IUserService,INotificationService,IIdentityService port
    class RedisSessionRepo,RedisTokenRepo,MongoDeviceTokenRepo,MongoAttemptRepo,BcryptPasswordHasher,JwtTokenGenerator,GoogleOAuth2Adapter,Auth0MFAAdapter,RedisRateLimiter,AuditSecurityLogger,UserContextAdapter,FCMNotificationAdapter,IdentityContextAdapter,SessionCache,PermissionCache,RateLimitCache adapter
    class RedisCache,MongoDB,GoogleOAuth2API,Auth0API,FCMService,AuditLogService,EmailService,SMSService external
    class LoginCmd,LogoutCmd,RefreshTokenCmd,ChangePasswordCmd,ResetPasswordCmd,EnableMFACmd,DisableMFACmd,RegisterDeviceCmd,RevokeTokenCmd,OAuth2LoginCmd command
    class ValidateTokenQuery,GetSessionQuery,GetActiveSessionsQuery,GetLoginHistoryQuery,CheckPermissionQuery,GetMFAStatusQuery,GetDeviceTokensQuery query
    class UserLoggedInEvent,UserLoggedOutEvent,PasswordChangedEvent,PasswordResetRequestedEvent,MFAEnabledEvent,MFADisabledEvent,DeviceRegisteredEvent,TokenRevokedEvent,LoginFailedEvent,AccountLockedEvent,SuspiciousActivityEvent,SessionExpiredEvent event
    class ActiveSessionsRM,LoginHistoryRM,SecurityDashboardRM,DeviceListRM,AuthStatsRM,FailedAttemptsRM,SecurityAlertsRM readModel
    class UserContext,IdentityContext,NotificationContext,OrganizationContext externalContext
    class AuthApplicationService applicationService
    class AuthCommandBus,AuthQueryBus,AuthEventBus contextBus
    class AuthPolicyEnforcementPoint,SecurityPolicyDecisionPoint policy