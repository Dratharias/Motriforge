graph TB
    %% ===== PRESENTATION LAYER =====
    subgraph Presentation ["📱 Presentation Layer"]
        Gateway["🌐 API Gateway<br/><<Gateway>>"]
        ContextRouter["🔀 Context Router<br/><<Router>>"]
    end
    
    %% ===== DECOMPOSED MIDDLEWARE FRAMEWORK =====
    subgraph DecomposedMiddlewareFramework ["🔧 Decomposed Middleware Framework <<Cross-Cutting>>"]
        
        %% ===== MIDDLEWARE CHAIN SUBSYSTEM =====
        subgraph MiddlewareChainSubsystem ["Middleware Chain Subsystem"]
            MiddlewareChain["⛓️ Middleware Chain<br/><<Orchestrator>>"]
            ChainExecutor["⚡ Chain Executor<br/><<Engine>>"]
            ChainValidator["✅ Chain Validator<br/><<Validator>>"]
            ChainFactory["🏭 Chain Factory<br/><<Factory>>"]
        end
        
        %% ===== MIDDLEWARE REGISTRY SUBSYSTEM =====
        subgraph MiddlewareRegistrySubsystem ["Middleware Registry Subsystem"]
            RegistryEventManager["📨 Registry Event Manager<br/><<EventManager>>"]
            MiddlewareDiscovery["🔍 Middleware Discovery<br/><<Discovery>>"]
            MiddlewareHealthChecker["❤️ Middleware Health Checker<br/><<HealthMonitor>>"]
            MiddlewareStatistics["📊 Middleware Statistics<br/><<Analytics>>"]
            MiddlewareValidator["✅ Middleware Validator<br/><<Validator>>"]
        end
        
        %% ===== MIDDLEWARE COORDINATION =====
        MiddlewareCoordinator["🎯 Middleware Coordinator<br/><<Coordinator>>"]
        PolicyEnforcementPoint["🛡️ Policy Enforcement Point<br/><<Security>>"]
    end
    
    %% ===== APPLICATION SERVICE LAYER =====
    subgraph ApplicationLayer ["🎯 Application Service Layer"]
        ServiceRegistry["📋 Application Service Registry<br/><<Locator>>"]
        
        subgraph ApplicationServices ["Application Services"]
            UserAppService["👤 User Application Service<br/><<Service>>"]
            OrgAppService["🏢 Organization Application Service<br/><<Service>>"]
            AuthAppService["🔐 Auth Application Service<br/><<Service>>"]
            WorkoutAppService["💪 Workout Application Service<br/><<Service>>"]
            ExerciseAppService["🎯 Exercise Application Service<br/><<Service>>"]
            ProgramAppService["📋 Program Application Service<br/><<Service>>"]
            ProgressionAppService["📈 Progression Application Service<br/><<Service>>"]
            TrainerAppService["👨‍🏫 Trainer Application Service<br/><<Service>>"]
            NotificationAppService["🔔 Notification Application Service<br/><<Service>>"]
            MedicalAppService["🏥 Medical Application Service<br/><<Service>>"]
        end
    end
    
    %% ===== IDENTITY & ACCESS MANAGEMENT LAYER =====
    subgraph IdentityLayer ["🔑 Identity & Access Management Layer"]
        IdentityContext["🆔 Identity Context<br/><<Context>>"]
        AccessManagementService["🔒 Access Management Service<br/><<Service>>"]
        SessionManagementService["📋 Session Management Service<br/><<Service>>"]
        CredentialManagementService["🔐 Credential Management Service<br/><<Service>>"]
    end
    
    %% ===== BOUNDED CONTEXTS WITH APPLICATION SERVICES =====
    subgraph BoundedContexts ["🎯 Bounded Contexts"]
        direction TB
        
        subgraph UserContext ["👤 User Context <<Bounded Context>>"]
            UserContextApp["👤 User Application Service<br/><<Internal>>"]
            UserAggregates["👤 User Aggregates<br/><<Domain>>"]
        end
        
        subgraph OrgContext ["🏢 Organization Context <<Bounded Context>>"]
            OrgContextApp["🏢 Org Application Service<br/><<Internal>>"]
            OrgAggregates["🏢 Org Aggregates<br/><<Domain>>"]
        end
        
        subgraph AuthContext ["🔐 Authentication Context <<Bounded Context>>"]
            AuthContextApp["🔐 Auth Application Service<br/><<Internal>>"]
            AuthAggregates["🔐 Auth Aggregates<br/><<Domain>>"]
        end
        
        subgraph WorkoutContext ["💪 Workout Context <<Bounded Context>>"]
            WorkoutContextApp["💪 Workout Application Service<br/><<Internal>>"]
            WorkoutAggregates["💪 Workout Aggregates<br/><<Domain>>"]
        end
        
        subgraph ExerciseContext ["🎯 Exercise Context <<Bounded Context>>"]
            ExerciseContextApp["🎯 Exercise Application Service<br/><<Internal>>"]
            ExerciseAggregates["🎯 Exercise Aggregates<br/><<Domain>>"]
        end
        
        subgraph ProgramContext ["📋 Program Context <<Bounded Context>>"]
            ProgramContextApp["📋 Program Application Service<br/><<Internal>>"]
            ProgramAggregates["📋 Program Aggregates<br/><<Domain>>"]
        end
        
        subgraph ProgressionContext ["📈 Progression Context <<Bounded Context>>"]
            ProgressionContextApp["📈 Progression Application Service<br/><<Internal>>"]
            ProgressionAggregates["📈 Progression Aggregates<br/><<Domain>>"]
        end
        
        subgraph TrainerContext ["👨‍🏫 Trainer Context <<Bounded Context>>"]
            TrainerContextApp["👨‍🏫 Trainer Application Service<br/><<Internal>>"]
            TrainerAggregates["👨‍🏫 Trainer Aggregates<br/><<Domain>>"]
        end
        
        subgraph NotificationContext ["🔔 Notification Context <<Bounded Context>>"]
            NotificationContextApp["🔔 Notification Application Service<br/><<Internal>>"]
            NotificationAggregates["🔔 Notification Aggregates<br/><<Domain>>"]
        end
        
        subgraph MedicalContext ["🏥 Medical Context <<Bounded Context>>"]
            MedicalContextApp["🏥 Medical Application Service<br/><<Internal>>"]
            MedicalAggregates["🏥 Medical Aggregates<br/><<Domain>>"]
        end
    end
    
    %% ===== ENHANCED SHARED INFRASTRUCTURE =====
    subgraph SharedInfra ["🔧 Shared Infrastructure"]
        ContextualEventBus["📨 Contextual Event Bus<br/><<EventBus>>"]
        ContextualEventStore["📚 Contextual Event Store<br/><<EventStore>>"]
        ContextualCommandBus["⚡ Contextual Command Bus<br/><<CommandBus>>"]
        ContextualQueryBus["❓ Contextual Query Bus<br/><<QueryBus>>"]
        ReadModelStore["📊 Read Model Store<br/><<ReadModels>>"]
        CacheCluster["💾 Cache Cluster<br/><<Cache>>"]
        Database["🗄️ Database<br/><<Database>>"]
        FileStorage["📁 File Storage<br/><<Storage>>"]
        SearchEngine["🔍 Search Engine<br/><<Search>>"]
    end
    
    %% ===== ENHANCED PLUGIN SYSTEM WITH SECURITY =====
    subgraph PluginSystem ["🔌 Plugin System"]
        PluginManager["🔌 Plugin Manager<br/><<Manager>>"]
        PluginSecurityGateway["🛡️ Plugin Security Gateway<br/><<Security>>"]
        PluginSandbox["📦 Plugin Sandbox<br/><<Isolation>>"]
        PluginRegistry["📋 Plugin Registry<br/><<Registry>>"]
    end
    
    %% ===== ENHANCED CROSS-CUTTING CONCERNS =====
    subgraph CrossCutting ["⚡ Cross-Cutting Concerns"]
        ContextualServiceDiscovery["📋 Contextual Service Discovery<br/><<Registry>>"]
        ConfigManager["⚙️ Configuration Manager<br/><<Config>>"]
        ContextualMetrics["📊 Contextual Metrics<br/><<Metrics>>"]
        DistributedLogging["📝 Distributed Logging<br/><<Logging>>"]
        ComplianceSecurity["🔒 Compliance & Security<br/><<Security>>"]
        ObservabilityStack["👁️ Observability Stack<br/><<Monitoring>>"]
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph External ["🌐 External Systems"]
        PaymentGateways["💳 Payment Gateways<br/><<External>>"]
        EmailProviders["📧 Email Providers<br/><<External>>"]
        PushServices["📱 Push Services<br/><<External>>"]
        CloudStorage["☁️ Cloud Storage<br/><<External>>"]
        AnalyticsPlatforms["📈 Analytics Platforms<br/><<External>>"]
        MedicalSystems["🏥 Medical Systems<br/><<External>>"]
        IdentityProviders["🆔 Identity Providers<br/><<External>>"]
    end
    
    %% ===== ANTI-CORRUPTION LAYERS =====
    subgraph ACL ["🛡️ Anti-Corruption Layers"]
        UserACL["👤 User ACL<br/><<AntiCorruption>>"]
        OrgACL["🏢 Organization ACL<br/><<AntiCorruption>>"]
        AuthACL["🔐 Auth ACL<br/><<AntiCorruption>>"]
        WorkoutACL["💪 Workout ACL<br/><<AntiCorruption>>"]
        ExerciseACL["🎯 Exercise ACL<br/><<AntiCorruption>>"]
        ProgramACL["📋 Program ACL<br/><<AntiCorruption>>"]
        ProgressionACL["📈 Progression ACL<br/><<AntiCorruption>>"]
        TrainerACL["🎯 Trainer ACL<br/><<AntiCorruption>>"]
        NotificationACL["🔔 Notification ACL<br/><<AntiCorruption>>"]
        MedicalACL["🏥 Medical ACL<br/><<AntiCorruption>>"]
    end
    
    %% ===== PRESENTATION TO MIDDLEWARE =====
    Gateway --> ContextRouter
    ContextRouter --> MiddlewareCoordinator
    
    %% ===== DECOMPOSED MIDDLEWARE INTERNAL RELATIONSHIPS =====
    
    %% Chain Subsystem Internal
    MiddlewareChain --> ChainExecutor
    MiddlewareChain --> ChainValidator
    ChainFactory --> MiddlewareChain
    
    %% Registry Subsystem Internal
    RegistryEventManager --> MiddlewareDiscovery
    RegistryEventManager --> MiddlewareHealthChecker
    RegistryEventManager --> MiddlewareStatistics
    RegistryEventManager --> MiddlewareValidator
    
    %% Coordination Between Subsystems
    MiddlewareCoordinator --> MiddlewareChain
    MiddlewareCoordinator --> RegistryEventManager
    MiddlewareCoordinator --> PolicyEnforcementPoint
    
    %% ===== MIDDLEWARE TO APPLICATION SERVICES =====
    MiddlewareCoordinator --> ServiceRegistry
    
    %% ===== SERVICE REGISTRY TO APPLICATION SERVICES =====
    ServiceRegistry --> UserAppService
    ServiceRegistry --> OrgAppService
    ServiceRegistry --> AuthAppService
    ServiceRegistry --> WorkoutAppService
    ServiceRegistry --> ExerciseAppService
    ServiceRegistry --> ProgramAppService
    ServiceRegistry --> ProgressionAppService
    ServiceRegistry --> TrainerAppService
    ServiceRegistry --> NotificationAppService
    ServiceRegistry --> MedicalAppService
    
    %% ===== APPLICATION SERVICES TO BOUNDED CONTEXTS =====
    UserAppService --> UserContext
    OrgAppService --> OrgContext
    AuthAppService --> AuthContext
    WorkoutAppService --> WorkoutContext
    ExerciseAppService --> ExerciseContext
    ProgramAppService --> ProgramContext
    ProgressionAppService --> ProgressionContext
    TrainerAppService --> TrainerContext
    NotificationAppService --> NotificationContext
    MedicalAppService --> MedicalContext
    
    %% ===== INTERNAL BOUNDED CONTEXT STRUCTURE =====
    UserContextApp --> UserAggregates
    OrgContextApp --> OrgAggregates
    AuthContextApp --> AuthAggregates
    WorkoutContextApp --> WorkoutAggregates
    ExerciseContextApp --> ExerciseAggregates
    ProgramContextApp --> ProgramAggregates
    ProgressionContextApp --> ProgressionAggregates
    TrainerContextApp --> TrainerAggregates
    NotificationContextApp --> NotificationAggregates
    MedicalContextApp --> MedicalAggregates
    
    %% ===== IDENTITY & ACCESS MANAGEMENT INTEGRATION =====
    MiddlewareCoordinator --> IdentityLayer
    PolicyEnforcementPoint --> AccessManagementService
    IdentityContext --> SessionManagementService
    IdentityContext --> CredentialManagementService
    SessionManagementService --> AuthContext
    
    %% ===== SHARED INFRASTRUCTURE CONNECTIONS =====
    ApplicationServices --> ContextualCommandBus
    ApplicationServices --> ContextualQueryBus
    ApplicationServices --> ContextualEventBus
    
    ContextualEventBus --> ContextualEventStore
    ContextualCommandBus --> ContextualEventStore
    ContextualQueryBus --> ReadModelStore
    ContextualEventBus --> ReadModelStore
    
    BoundedContexts --> SharedInfra
    
    %% ===== PLUGIN SYSTEM INTEGRATION =====
    PluginManager --> PluginSecurityGateway
    PluginSecurityGateway --> PolicyEnforcementPoint
    PluginManager --> ServiceRegistry
    PluginSandbox --> PluginRegistry
    
    %% ===== MIDDLEWARE-PLUGIN INTEGRATION =====
    PluginManager --> MiddlewareChain
    PluginManager --> RegistryEventManager
    PluginSecurityGateway --> MiddlewareValidator
    
    %% ===== CROSS-CUTTING INTEGRATION =====
    ApplicationServices --> CrossCutting
    BoundedContexts --> CrossCutting
    SharedInfra --> CrossCutting
    DecomposedMiddlewareFramework --> CrossCutting
    
    %% ===== MIDDLEWARE CROSS-CUTTING INTEGRATION =====
    MiddlewareStatistics --> ContextualMetrics
    MiddlewareHealthChecker --> ObservabilityStack
    RegistryEventManager --> DistributedLogging
    PolicyEnforcementPoint --> ComplianceSecurity
    
    %% ===== ANTI-CORRUPTION LAYER CONNECTIONS =====
    UserACL --> UserContext
    OrgACL --> OrgContext
    AuthACL --> AuthContext
    WorkoutACL --> WorkoutContext
    ExerciseACL --> ExerciseContext
    ProgramACL --> ProgramContext
    ProgressionACL --> ProgressionContext
    TrainerACL --> TrainerContext
    NotificationACL --> NotificationContext
    MedicalACL --> MedicalContext
    
    %% ===== EXTERNAL SYSTEM CONNECTIONS =====
    NotificationContext --> EmailProviders
    NotificationContext --> PushServices
    TrainerContext --> PaymentGateways
    UserContext --> CloudStorage
    ProgressionContext --> AnalyticsPlatforms
    MedicalContext --> MedicalSystems
    IdentityLayer --> IdentityProviders
    
    %% ===== MONITORING & HEALTH INTEGRATION =====
    MiddlewareHealthChecker --> ObservabilityStack
    MiddlewareStatistics --> ContextualMetrics
    ChainExecutor --> DistributedLogging
    RegistryEventManager --> DistributedLogging