graph TB
    %% ===== PRESENTATION LAYER =====
    subgraph Presentation ["ğŸ“± Presentation Layer"]
        Gateway["ğŸŒ API Gateway<br/><<Gateway>>"]
        ContextRouter["ğŸ”€ Context Router<br/><<Router>>"]
    end
    
    %% ===== DECOMPOSED MIDDLEWARE FRAMEWORK =====
    subgraph DecomposedMiddlewareFramework ["ğŸ”§ Decomposed Middleware Framework <<Cross-Cutting>>"]
        
        %% ===== MIDDLEWARE CHAIN SUBSYSTEM =====
        subgraph MiddlewareChainSubsystem ["Middleware Chain Subsystem"]
            MiddlewareChain["â›“ï¸ Middleware Chain<br/><<Orchestrator>>"]
            ChainExecutor["âš¡ Chain Executor<br/><<Engine>>"]
            ChainValidator["âœ… Chain Validator<br/><<Validator>>"]
            ChainFactory["ğŸ­ Chain Factory<br/><<Factory>>"]
        end
        
        %% ===== MIDDLEWARE REGISTRY SUBSYSTEM =====
        subgraph MiddlewareRegistrySubsystem ["Middleware Registry Subsystem"]
            RegistryEventManager["ğŸ“¨ Registry Event Manager<br/><<EventManager>>"]
            MiddlewareDiscovery["ğŸ” Middleware Discovery<br/><<Discovery>>"]
            MiddlewareHealthChecker["â¤ï¸ Middleware Health Checker<br/><<HealthMonitor>>"]
            MiddlewareStatistics["ğŸ“Š Middleware Statistics<br/><<Analytics>>"]
            MiddlewareValidator["âœ… Middleware Validator<br/><<Validator>>"]
        end
        
        %% ===== MIDDLEWARE COORDINATION =====
        MiddlewareCoordinator["ğŸ¯ Middleware Coordinator<br/><<Coordinator>>"]
        PolicyEnforcementPoint["ğŸ›¡ï¸ Policy Enforcement Point<br/><<Security>>"]
    end
    
    %% ===== APPLICATION SERVICE LAYER =====
    subgraph ApplicationLayer ["ğŸ¯ Application Service Layer"]
        ServiceRegistry["ğŸ“‹ Application Service Registry<br/><<Locator>>"]
        
        subgraph ApplicationServices ["Application Services"]
            UserAppService["ğŸ‘¤ User Application Service<br/><<Service>>"]
            OrgAppService["ğŸ¢ Organization Application Service<br/><<Service>>"]
            AuthAppService["ğŸ” Auth Application Service<br/><<Service>>"]
            WorkoutAppService["ğŸ’ª Workout Application Service<br/><<Service>>"]
            ExerciseAppService["ğŸ¯ Exercise Application Service<br/><<Service>>"]
            ProgramAppService["ğŸ“‹ Program Application Service<br/><<Service>>"]
            ProgressionAppService["ğŸ“ˆ Progression Application Service<br/><<Service>>"]
            TrainerAppService["ğŸ‘¨â€ğŸ« Trainer Application Service<br/><<Service>>"]
            NotificationAppService["ğŸ”” Notification Application Service<br/><<Service>>"]
            MedicalAppService["ğŸ¥ Medical Application Service<br/><<Service>>"]
        end
    end
    
    %% ===== IDENTITY & ACCESS MANAGEMENT LAYER =====
    subgraph IdentityLayer ["ğŸ”‘ Identity & Access Management Layer"]
        IdentityContext["ğŸ†” Identity Context<br/><<Context>>"]
        AccessManagementService["ğŸ”’ Access Management Service<br/><<Service>>"]
        SessionManagementService["ğŸ“‹ Session Management Service<br/><<Service>>"]
        CredentialManagementService["ğŸ” Credential Management Service<br/><<Service>>"]
    end
    
    %% ===== BOUNDED CONTEXTS WITH APPLICATION SERVICES =====
    subgraph BoundedContexts ["ğŸ¯ Bounded Contexts"]
        direction TB
        
        subgraph UserContext ["ğŸ‘¤ User Context <<Bounded Context>>"]
            UserContextApp["ğŸ‘¤ User Application Service<br/><<Internal>>"]
            UserAggregates["ğŸ‘¤ User Aggregates<br/><<Domain>>"]
        end
        
        subgraph OrgContext ["ğŸ¢ Organization Context <<Bounded Context>>"]
            OrgContextApp["ğŸ¢ Org Application Service<br/><<Internal>>"]
            OrgAggregates["ğŸ¢ Org Aggregates<br/><<Domain>>"]
        end
        
        subgraph AuthContext ["ğŸ” Authentication Context <<Bounded Context>>"]
            AuthContextApp["ğŸ” Auth Application Service<br/><<Internal>>"]
            AuthAggregates["ğŸ” Auth Aggregates<br/><<Domain>>"]
        end
        
        subgraph WorkoutContext ["ğŸ’ª Workout Context <<Bounded Context>>"]
            WorkoutContextApp["ğŸ’ª Workout Application Service<br/><<Internal>>"]
            WorkoutAggregates["ğŸ’ª Workout Aggregates<br/><<Domain>>"]
        end
        
        subgraph ExerciseContext ["ğŸ¯ Exercise Context <<Bounded Context>>"]
            ExerciseContextApp["ğŸ¯ Exercise Application Service<br/><<Internal>>"]
            ExerciseAggregates["ğŸ¯ Exercise Aggregates<br/><<Domain>>"]
        end
        
        subgraph ProgramContext ["ğŸ“‹ Program Context <<Bounded Context>>"]
            ProgramContextApp["ğŸ“‹ Program Application Service<br/><<Internal>>"]
            ProgramAggregates["ğŸ“‹ Program Aggregates<br/><<Domain>>"]
        end
        
        subgraph ProgressionContext ["ğŸ“ˆ Progression Context <<Bounded Context>>"]
            ProgressionContextApp["ğŸ“ˆ Progression Application Service<br/><<Internal>>"]
            ProgressionAggregates["ğŸ“ˆ Progression Aggregates<br/><<Domain>>"]
        end
        
        subgraph TrainerContext ["ğŸ‘¨â€ğŸ« Trainer Context <<Bounded Context>>"]
            TrainerContextApp["ğŸ‘¨â€ğŸ« Trainer Application Service<br/><<Internal>>"]
            TrainerAggregates["ğŸ‘¨â€ğŸ« Trainer Aggregates<br/><<Domain>>"]
        end
        
        subgraph NotificationContext ["ğŸ”” Notification Context <<Bounded Context>>"]
            NotificationContextApp["ğŸ”” Notification Application Service<br/><<Internal>>"]
            NotificationAggregates["ğŸ”” Notification Aggregates<br/><<Domain>>"]
        end
        
        subgraph MedicalContext ["ğŸ¥ Medical Context <<Bounded Context>>"]
            MedicalContextApp["ğŸ¥ Medical Application Service<br/><<Internal>>"]
            MedicalAggregates["ğŸ¥ Medical Aggregates<br/><<Domain>>"]
        end
    end
    
    %% ===== ENHANCED SHARED INFRASTRUCTURE =====
    subgraph SharedInfra ["ğŸ”§ Shared Infrastructure"]
        ContextualEventBus["ğŸ“¨ Contextual Event Bus<br/><<EventBus>>"]
        ContextualEventStore["ğŸ“š Contextual Event Store<br/><<EventStore>>"]
        ContextualCommandBus["âš¡ Contextual Command Bus<br/><<CommandBus>>"]
        ContextualQueryBus["â“ Contextual Query Bus<br/><<QueryBus>>"]
        ReadModelStore["ğŸ“Š Read Model Store<br/><<ReadModels>>"]
        CacheCluster["ğŸ’¾ Cache Cluster<br/><<Cache>>"]
        Database["ğŸ—„ï¸ Database<br/><<Database>>"]
        FileStorage["ğŸ“ File Storage<br/><<Storage>>"]
        SearchEngine["ğŸ” Search Engine<br/><<Search>>"]
    end
    
    %% ===== ENHANCED PLUGIN SYSTEM WITH SECURITY =====
    subgraph PluginSystem ["ğŸ”Œ Plugin System"]
        PluginManager["ğŸ”Œ Plugin Manager<br/><<Manager>>"]
        PluginSecurityGateway["ğŸ›¡ï¸ Plugin Security Gateway<br/><<Security>>"]
        PluginSandbox["ğŸ“¦ Plugin Sandbox<br/><<Isolation>>"]
        PluginRegistry["ğŸ“‹ Plugin Registry<br/><<Registry>>"]
    end
    
    %% ===== ENHANCED CROSS-CUTTING CONCERNS =====
    subgraph CrossCutting ["âš¡ Cross-Cutting Concerns"]
        ContextualServiceDiscovery["ğŸ“‹ Contextual Service Discovery<br/><<Registry>>"]
        ConfigManager["âš™ï¸ Configuration Manager<br/><<Config>>"]
        ContextualMetrics["ğŸ“Š Contextual Metrics<br/><<Metrics>>"]
        DistributedLogging["ğŸ“ Distributed Logging<br/><<Logging>>"]
        ComplianceSecurity["ğŸ”’ Compliance & Security<br/><<Security>>"]
        ObservabilityStack["ğŸ‘ï¸ Observability Stack<br/><<Monitoring>>"]
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph External ["ğŸŒ External Systems"]
        PaymentGateways["ğŸ’³ Payment Gateways<br/><<External>>"]
        EmailProviders["ğŸ“§ Email Providers<br/><<External>>"]
        PushServices["ğŸ“± Push Services<br/><<External>>"]
        CloudStorage["â˜ï¸ Cloud Storage<br/><<External>>"]
        AnalyticsPlatforms["ğŸ“ˆ Analytics Platforms<br/><<External>>"]
        MedicalSystems["ğŸ¥ Medical Systems<br/><<External>>"]
        IdentityProviders["ğŸ†” Identity Providers<br/><<External>>"]
    end
    
    %% ===== ANTI-CORRUPTION LAYERS =====
    subgraph ACL ["ğŸ›¡ï¸ Anti-Corruption Layers"]
        UserACL["ğŸ‘¤ User ACL<br/><<AntiCorruption>>"]
        OrgACL["ğŸ¢ Organization ACL<br/><<AntiCorruption>>"]
        AuthACL["ğŸ” Auth ACL<br/><<AntiCorruption>>"]
        WorkoutACL["ğŸ’ª Workout ACL<br/><<AntiCorruption>>"]
        ExerciseACL["ğŸ¯ Exercise ACL<br/><<AntiCorruption>>"]
        ProgramACL["ğŸ“‹ Program ACL<br/><<AntiCorruption>>"]
        ProgressionACL["ğŸ“ˆ Progression ACL<br/><<AntiCorruption>>"]
        TrainerACL["ğŸ¯ Trainer ACL<br/><<AntiCorruption>>"]
        NotificationACL["ğŸ”” Notification ACL<br/><<AntiCorruption>>"]
        MedicalACL["ğŸ¥ Medical ACL<br/><<AntiCorruption>>"]
    end
    
    %% ===== PRESENTATION TO MIDDLEWARE =====
    Gateway --> ContextRouter
    ContextRouter --> MiddlewareCoordinator
    
    %% ===== DECOMPOSED MIDDLEWARE INTERNAL RELATIONSHIPS =====
    
    %% Chain Subsystem Internal
    MiddlewareChain --> ChainExecutor
    MiddlewareChain --> ChainValidator
    ChainFactory --> MiddlewareChain
    
    %% Registry Subsystem Internal
    RegistryEventManager --> MiddlewareDiscovery
    RegistryEventManager --> MiddlewareHealthChecker
    RegistryEventManager --> MiddlewareStatistics
    RegistryEventManager --> MiddlewareValidator
    
    %% Coordination Between Subsystems
    MiddlewareCoordinator --> MiddlewareChain
    MiddlewareCoordinator --> RegistryEventManager
    MiddlewareCoordinator --> PolicyEnforcementPoint
    
    %% ===== MIDDLEWARE TO APPLICATION SERVICES =====
    MiddlewareCoordinator --> ServiceRegistry
    
    %% ===== SERVICE REGISTRY TO APPLICATION SERVICES =====
    ServiceRegistry --> UserAppService
    ServiceRegistry --> OrgAppService
    ServiceRegistry --> AuthAppService
    ServiceRegistry --> WorkoutAppService
    ServiceRegistry --> ExerciseAppService
    ServiceRegistry --> ProgramAppService
    ServiceRegistry --> ProgressionAppService
    ServiceRegistry --> TrainerAppService
    ServiceRegistry --> NotificationAppService
    ServiceRegistry --> MedicalAppService
    
    %% ===== APPLICATION SERVICES TO BOUNDED CONTEXTS =====
    UserAppService --> UserContext
    OrgAppService --> OrgContext
    AuthAppService --> AuthContext
    WorkoutAppService --> WorkoutContext
    ExerciseAppService --> ExerciseContext
    ProgramAppService --> ProgramContext
    ProgressionAppService --> ProgressionContext
    TrainerAppService --> TrainerContext
    NotificationAppService --> NotificationContext
    MedicalAppService --> MedicalContext
    
    %% ===== INTERNAL BOUNDED CONTEXT STRUCTURE =====
    UserContextApp --> UserAggregates
    OrgContextApp --> OrgAggregates
    AuthContextApp --> AuthAggregates
    WorkoutContextApp --> WorkoutAggregates
    ExerciseContextApp --> ExerciseAggregates
    ProgramContextApp --> ProgramAggregates
    ProgressionContextApp --> ProgressionAggregates
    TrainerContextApp --> TrainerAggregates
    NotificationContextApp --> NotificationAggregates
    MedicalContextApp --> MedicalAggregates
    
    %% ===== IDENTITY & ACCESS MANAGEMENT INTEGRATION =====
    MiddlewareCoordinator --> IdentityLayer
    PolicyEnforcementPoint --> AccessManagementService
    IdentityContext --> SessionManagementService
    IdentityContext --> CredentialManagementService
    SessionManagementService --> AuthContext
    
    %% ===== SHARED INFRASTRUCTURE CONNECTIONS =====
    ApplicationServices --> ContextualCommandBus
    ApplicationServices --> ContextualQueryBus
    ApplicationServices --> ContextualEventBus
    
    ContextualEventBus --> ContextualEventStore
    ContextualCommandBus --> ContextualEventStore
    ContextualQueryBus --> ReadModelStore
    ContextualEventBus --> ReadModelStore
    
    BoundedContexts --> SharedInfra
    
    %% ===== PLUGIN SYSTEM INTEGRATION =====
    PluginManager --> PluginSecurityGateway
    PluginSecurityGateway --> PolicyEnforcementPoint
    PluginManager --> ServiceRegistry
    PluginSandbox --> PluginRegistry
    
    %% ===== MIDDLEWARE-PLUGIN INTEGRATION =====
    PluginManager --> MiddlewareChain
    PluginManager --> RegistryEventManager
    PluginSecurityGateway --> MiddlewareValidator
    
    %% ===== CROSS-CUTTING INTEGRATION =====
    ApplicationServices --> CrossCutting
    BoundedContexts --> CrossCutting
    SharedInfra --> CrossCutting
    DecomposedMiddlewareFramework --> CrossCutting
    
    %% ===== MIDDLEWARE CROSS-CUTTING INTEGRATION =====
    MiddlewareStatistics --> ContextualMetrics
    MiddlewareHealthChecker --> ObservabilityStack
    RegistryEventManager --> DistributedLogging
    PolicyEnforcementPoint --> ComplianceSecurity
    
    %% ===== ANTI-CORRUPTION LAYER CONNECTIONS =====
    UserACL --> UserContext
    OrgACL --> OrgContext
    AuthACL --> AuthContext
    WorkoutACL --> WorkoutContext
    ExerciseACL --> ExerciseContext
    ProgramACL --> ProgramContext
    ProgressionACL --> ProgressionContext
    TrainerACL --> TrainerContext
    NotificationACL --> NotificationContext
    MedicalACL --> MedicalContext
    
    %% ===== EXTERNAL SYSTEM CONNECTIONS =====
    NotificationContext --> EmailProviders
    NotificationContext --> PushServices
    TrainerContext --> PaymentGateways
    UserContext --> CloudStorage
    ProgressionContext --> AnalyticsPlatforms
    MedicalContext --> MedicalSystems
    IdentityLayer --> IdentityProviders
    
    %% ===== MONITORING & HEALTH INTEGRATION =====
    MiddlewareHealthChecker --> ObservabilityStack
    MiddlewareStatistics --> ContextualMetrics
    ChainExecutor --> DistributedLogging
    RegistryEventManager --> DistributedLogging