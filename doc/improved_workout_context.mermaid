graph TB
    %% ===== WORKOUT MANAGEMENT CONTEXT =====
    subgraph WorkoutContext ["ğŸ’ª Workout Management Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph WorkoutApplicationLayer ["Application Service Layer <<Application>>"]
            WorkoutApplicationService["ğŸ’ª Workout Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph WorkoutCommands ["Commands"]
                CreateWorkoutCmd["â• Create Workout<br/><<Command>>"]
                UpdateWorkoutCmd["âœï¸ Update Workout<br/><<Command>>"]
                AddBlockCmd["ğŸ“¦ Add Block<br/><<Command>>"]
                AddExerciseCmd["ğŸ¯ Add Exercise<br/><<Command>>"]
                ReorderExercisesCmd["ğŸ”„ Reorder Exercises<br/><<Command>>"]
                SaveAsTemplateCmd["ğŸ“‹ Save as Template<br/><<Command>>"]
                UploadWorkoutMediaCmd["ğŸ“ Upload Media<br/><<Command>>"]
                DeleteWorkoutCmd["ğŸ—‘ï¸ Delete Workout<br/><<Command>>"]
                PublishWorkoutCmd["ğŸŒ Publish Workout<br/><<Command>>"]
            end
            
            %% Queries
            subgraph WorkoutQueries ["Queries"]
                GetWorkoutQuery["ğŸ’ª Get Workout<br/><<Query>>"]
                GetWorkoutTemplatesQuery["ğŸ“‹ Get Templates<br/><<Query>>"]
                GetWorkoutHistoryQuery["ğŸ“… Get History<br/><<Query>>"]
                SearchWorkoutsQuery["ğŸ” Search Workouts<br/><<Query>>"]
                GetPopularWorkoutsQuery["â­ Get Popular<br/><<Query>>"]
                GetWorkoutStatsQuery["ğŸ“Š Get Stats<br/><<Query>>"]
                GetUserWorkoutsQuery["ğŸ‘¤ Get User Workouts<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph WorkoutSagas ["Sagas"]
                WorkoutCreationSaga["ğŸ’ª Workout Creation<br/><<Saga>>"]
                MediaProcessingSaga["ğŸ“ Media Processing<br/><<Saga>>"]
                WorkoutSharingSaga["ğŸ”— Workout Sharing<br/><<Saga>>"]
                WorkoutValidationSaga["âœ… Workout Validation<br/><<Saga>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph WorkoutDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Workout["ğŸ’ª Workout<br/><<AggregateRoot>>"]
            WorkoutTemplate["ğŸ“‹ Workout Template<br/><<AggregateRoot>>"]
            
            %% Entities
            WorkoutBlock["ğŸ“¦ Workout Block<br/><<Entity>>"]
            WorkoutExercise["ğŸ¯ Workout Exercise<br/><<Entity>>"]
            Media["ğŸ“ Media<br/><<Entity>>"]
            MediaVariant["ğŸ–¼ï¸ Media Variant<br/><<Entity>>"]
            
            %% Value Objects
            WorkoutId["ğŸ†” Workout ID<br/><<ValueObject>>"]
            WorkoutName["ğŸ·ï¸ Workout Name<br/><<ValueObject>>"]
            Duration["â±ï¸ Duration<br/><<ValueObject>>"]
            IntensityLevel["ğŸ”¥ Intensity Level<br/><<ValueObject>>"]
            RestPeriod["ğŸ˜´ Rest Period<br/><<ValueObject>>"]
            
            %% Domain Services
            WorkoutPlanningService["ğŸ“ Workout Planning<br/><<DomainService>>"]
            WorkoutValidationService["âœ… Workout Validation<br/><<DomainService>>"]
            CalorieCalculationService["ğŸ”¥ Calorie Calculation<br/><<DomainService>>"]
            WorkoutSharingService["ğŸ”— Workout Sharing<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph WorkoutPorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IWorkoutRepo["ğŸ’ª IWorkoutRepository<br/><<Port>>"]
            IWorkoutTemplateRepo["ğŸ“‹ IWorkoutTemplateRepository<br/><<Port>>"]
            IMediaRepo["ğŸ“ IMediaRepository<br/><<Port>>"]
            
            %% Service Ports
            IExerciseService["ğŸ¯ IExerciseService<br/><<Port>>"]
            IProgressionService["ğŸ“ˆ IProgressionService<br/><<Port>>"]
            IMediaProcessingService["ğŸ–¼ï¸ IMediaProcessingService<br/><<Port>>"]
            INotificationService["ğŸ”” INotificationService<br/><<Port>>"]
            IAnalyticsService["ğŸ“Š IAnalyticsService<br/><<Port>>"]
            IUserService["ğŸ‘¤ IUserService<br/><<Port>>"]
            IIdentityService["ğŸ†” IIdentityService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph WorkoutAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph WorkoutRepositoryAdapters ["Repository Adapters"]
                MongoWorkoutRepo["ğŸ—„ï¸ Mongo Workout Repository<br/><<RepositoryAdapter>>"]
                MongoTemplateRepo["ğŸ—„ï¸ Mongo Template Repository<br/><<RepositoryAdapter>>"]
                MongoMediaRepo["ğŸ—„ï¸ Mongo Media Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph WorkoutServiceAdapters ["Service Adapters"]
                ExerciseContextAdapter["ğŸ¯ Exercise Context<br/><<ContextAdapter>>"]
                ProgressionContextAdapter["ğŸ“ˆ Progression Context<br/><<ContextAdapter>>"]
                CloudinaryMediaAdapter["â˜ï¸ Cloudinary Media<br/><<MediaAdapter>>"]
                FCMNotificationAdapter["ğŸ“± FCM Notification<br/><<NotificationAdapter>>"]
                MixpanelAnalyticsAdapter["ğŸ“Š Mixpanel Analytics<br/><<AnalyticsAdapter>>"]
                UserContextAdapter["ğŸ‘¤ User Context<br/><<ContextAdapter>>"]
                IdentityContextAdapter["ğŸ†” Identity Context<br/><<ContextAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph WorkoutCacheAdapters ["Cache Adapters"]
                WorkoutCache["ğŸ’¾ Workout Cache<br/><<CacheAdapter>>"]
                TemplateCache["ğŸ’¾ Template Cache<br/><<CacheAdapter>>"]
                PopularWorkoutsCache["ğŸ’¾ Popular Cache<br/><<CacheAdapter>>"]
                MediaCache["ğŸ’¾ Media Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph WorkoutContextBus ["Context Bus Interfaces"]
            WorkoutCommandBus["âš¡ Workout Command Bus<br/><<CommandBus>>"]
            WorkoutQueryBus["â“ Workout Query Bus<br/><<QueryBus>>"]
            WorkoutEventBus["ğŸ“¨ Workout Event Bus<br/><<EventBus>>"]
        end
        
        %% ===== POLICY ENFORCEMENT =====
        subgraph WorkoutPolicyLayer ["Policy Enforcement Layer"]
            WorkoutPolicyEnforcementPoint["ğŸ›¡ï¸ Workout Policy Enforcement Point<br/><<PEP>>"]
            ContentModerationService["ğŸ” Content Moderation Service<br/><<Moderation>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph WorkoutExternal ["ğŸŒ External Systems"]
        MongoDB["ğŸ—„ï¸ MongoDB<br/><<Database>>"]
        RedisCache["ğŸ”´ Redis<br/><<Cache>>"]
        CloudinaryAPI["â˜ï¸ Cloudinary API<br/><<MediaService>>"]
        FCMService["ğŸ“± FCM Service<br/><<NotificationService>>"]
        MixpanelAPI["ğŸ“Š Mixpanel API<br/><<AnalyticsService>>"]
        CDN["ğŸŒ CDN<br/><<ContentDelivery>>"]
        ElasticsearchCluster["ğŸ” Elasticsearch<br/><<SearchEngine>>"]
    end
    
    %% ===== EVENTS =====
    subgraph WorkoutEvents ["ğŸ“¨ Domain Events"]
        WorkoutCreatedEvent["ğŸ’ª Workout Created<br/><<DomainEvent>>"]
        WorkoutUpdatedEvent["âœï¸ Workout Updated<br/><<DomainEvent>>"]
        WorkoutDeletedEvent["ğŸ—‘ï¸ Workout Deleted<br/><<DomainEvent>>"]
        BlockAddedEvent["ğŸ“¦ Block Added<br/><<DomainEvent>>"]
        ExerciseAddedEvent["ğŸ¯ Exercise Added<br/><<DomainEvent>>"]
        TemplateCreatedEvent["ğŸ“‹ Template Created<br/><<DomainEvent>>"]
        MediaUploadedEvent["ğŸ“ Media Uploaded<br/><<DomainEvent>>"]
        WorkoutSharedEvent["ğŸ”— Workout Shared<br/><<DomainEvent>>"]
        WorkoutPublishedEvent["ğŸŒ Workout Published<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph WorkoutReadModels ["ğŸ“Š Read Models"]
        WorkoutCatalogRM["ğŸ’ª Workout Catalog<br/><<ReadModel>>"]
        WorkoutDetailsRM["ğŸ’ª Workout Details<br/><<ReadModel>>"]
        WorkoutTemplatesRM["ğŸ“‹ Workout Templates<br/><<ReadModel>>"]
        PopularWorkoutsRM["â­ Popular Workouts<br/><<ReadModel>>"]
        WorkoutStatsRM["ğŸ“Š Workout Stats<br/><<ReadModel>>"]
        UserWorkoutsRM["ğŸ‘¤ User Workouts<br/><<ReadModel>>"]
        WorkoutSearchRM["ğŸ” Workout Search<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["ğŸŒ External Contexts"]
        ExerciseContext["ğŸ¯ Exercise Context<br/><<ExternalContext>>"]
        ProgressionContext["ğŸ“ˆ Progression Context<br/><<ExternalContext>>"]
        UserContext["ğŸ‘¤ User Context<br/><<ExternalContext>>"]
        IdentityContext["ğŸ†” Identity Context<br/><<ExternalContext>>"]
        NotificationContext["ğŸ”” Notification Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    WorkoutApplicationService --> WorkoutCommandBus
    WorkoutApplicationService --> WorkoutQueryBus
    WorkoutApplicationService --> WorkoutEventBus
    
    %% Commands and Queries through Application Service
    WorkoutCommands --> WorkoutApplicationService
    WorkoutQueries --> WorkoutApplicationService
    WorkoutSagas --> WorkoutApplicationService
    
    %% Application Service to Domain (orchestration)
    WorkoutApplicationService --> Workout
    WorkoutApplicationService --> WorkoutTemplate
    WorkoutApplicationService --> WorkoutPlanningService
    WorkoutApplicationService --> WorkoutValidationService
    WorkoutApplicationService --> CalorieCalculationService
    WorkoutApplicationService --> WorkoutSharingService
    
    %% Policy Enforcement Integration
    WorkoutApplicationService --> WorkoutPolicyEnforcementPoint
    WorkoutPolicyEnforcementPoint --> ContentModerationService
    
    %% Domain to Ports (Dependency Inversion)
    Workout -->|uses| IWorkoutRepo
    Workout -->|uses| IExerciseService
    Workout -->|uses| IProgressionService
    WorkoutTemplate -->|uses| IWorkoutTemplateRepo
    WorkoutPlanningService -->|uses| IAnalyticsService
    CalorieCalculationService -->|uses| IExerciseService
    WorkoutSharingService -->|uses| INotificationService
    WorkoutValidationService -->|uses| IUserService
    WorkoutValidationService -->|uses| IIdentityService
    
    %% Ports to Adapters (Implementation)
    IWorkoutRepo -.->|implements| MongoWorkoutRepo
    IWorkoutTemplateRepo -.->|implements| MongoTemplateRepo
    IMediaRepo -.->|implements| MongoMediaRepo
    IExerciseService -.->|implements| ExerciseContextAdapter
    IProgressionService -.->|implements| ProgressionContextAdapter
    IMediaProcessingService -.->|implements| CloudinaryMediaAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    IAnalyticsService -.->|implements| MixpanelAnalyticsAdapter
    IUserService -.->|implements| UserContextAdapter
    IIdentityService -.->|implements| IdentityContextAdapter
    
    %% Adapters to External Systems
    MongoWorkoutRepo -->|connects| MongoDB
    MongoTemplateRepo -->|connects| MongoDB
    MongoMediaRepo -->|connects| MongoDB
    WorkoutCache -->|connects| RedisCache
    TemplateCache -->|connects| RedisCache
    PopularWorkoutsCache -->|connects| RedisCache
    MediaCache -->|connects| RedisCache
    CloudinaryMediaAdapter -->|connects| CloudinaryAPI
    CloudinaryMediaAdapter -->|serves via| CDN
    FCMNotificationAdapter -->|connects| FCMService
    MixpanelAnalyticsAdapter -->|connects| MixpanelAPI
    
    %% Cross-Context Communication
    ExerciseContextAdapter -.->|async calls| ExerciseContext
    ProgressionContextAdapter -.->|async calls| ProgressionContext
    UserContextAdapter -.->|async calls| UserContext
    IdentityContextAdapter -.->|async calls| IdentityContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    
    %% Domain Events
    Workout -.->|publishes| WorkoutCreatedEvent
    Workout -.->|publishes| WorkoutUpdatedEvent
    Workout -.->|publishes| WorkoutDeletedEvent
    WorkoutBlock -.->|publishes| BlockAddedEvent
    WorkoutExercise -.->|publishes| ExerciseAddedEvent
    WorkoutTemplate -.->|publishes| TemplateCreatedEvent
    Media -.->|publishes| MediaUploadedEvent
    Workout -.->|publishes| WorkoutSharedEvent
    Workout -.->|publishes| WorkoutPublishedEvent
    
    %% Event to Read Models (via Event Bus)
    WorkoutEventBus -.->|projects to| WorkoutCatalogRM
    WorkoutEventBus -.->|projects to| WorkoutDetailsRM
    WorkoutEventBus -.->|projects to| WorkoutTemplatesRM
    WorkoutEventBus -.->|projects to| PopularWorkoutsRM
    WorkoutEventBus -.->|projects to| WorkoutStatsRM
    WorkoutEventBus -.->|projects to| UserWorkoutsRM
    WorkoutEventBus -.->|projects to| WorkoutSearchRM
    
    %% Events to Event Bus
    WorkoutCreatedEvent -.->|publishes to| WorkoutEventBus
    WorkoutUpdatedEvent -.->|publishes to| WorkoutEventBus
    WorkoutDeletedEvent -.->|publishes to| WorkoutEventBus
    BlockAddedEvent -.->|publishes to| WorkoutEventBus
    ExerciseAddedEvent -.->|publishes to| WorkoutEventBus
    TemplateCreatedEvent -.->|publishes to| WorkoutEventBus
    MediaUploadedEvent -.->|publishes to| WorkoutEventBus
    WorkoutSharedEvent -.->|publishes to| WorkoutEventBus
    WorkoutPublishedEvent -.->|publishes to| WorkoutEventBus
    
    %% Sagas listen to events
    WorkoutCreationSaga -.->|listens to| WorkoutCreatedEvent
    MediaProcessingSaga -.->|listens to| MediaUploadedEvent
    WorkoutSharingSaga -.->|listens to| WorkoutSharedEvent
    WorkoutValidationSaga -.->|listens to| WorkoutPublishedEvent
    
    %% Context Bus to External Event Bus
    WorkoutEventBus -.->|integrates with| ExternalContexts
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef externalContext fill:#f5f5f5,stroke:#757575,stroke-width:2px,stroke-dasharray: 5 5
    classDef applicationService fill:#e3f2fd,stroke:#0277bd,stroke-width:4px
    classDef contextBus fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    
    class Workout,WorkoutTemplate aggregate
    class WorkoutBlock,WorkoutExercise,Media,MediaVariant entity
    class WorkoutId,WorkoutName,Duration,IntensityLevel,RestPeriod valueObject
    class IWorkoutRepo,IWorkoutTemplateRepo,IMediaRepo,IExerciseService,IProgressionService,IMediaProcessingService,INotificationService,IAnalyticsService,IUserService,IIdentityService port
    class MongoWorkoutRepo,MongoTemplateRepo,MongoMediaRepo,ExerciseContextAdapter,ProgressionContextAdapter,CloudinaryMediaAdapter,FCMNotificationAdapter,MixpanelAnalyticsAdapter,UserContextAdapter,IdentityContextAdapter,WorkoutCache,TemplateCache,PopularWorkoutsCache,MediaCache adapter
    class MongoDB,RedisCache,CloudinaryAPI,FCMService,MixpanelAPI,CDN,ElasticsearchCluster external
    class CreateWorkoutCmd,UpdateWorkoutCmd,AddBlockCmd,AddExerciseCmd,ReorderExercisesCmd,SaveAsTemplateCmd,UploadWorkoutMediaCmd,DeleteWorkoutCmd,PublishWorkoutCmd command
    class GetWorkoutQuery,GetWorkoutTemplatesQuery,GetWorkoutHistoryQuery,SearchWorkoutsQuery,GetPopularWorkoutsQuery,GetWorkoutStatsQuery,GetUserWorkoutsQuery query
    class WorkoutCreatedEvent,WorkoutUpdatedEvent,WorkoutDeletedEvent,BlockAddedEvent,ExerciseAddedEvent,TemplateCreatedEvent,MediaUploadedEvent,WorkoutSharedEvent,WorkoutPublishedEvent event
    class WorkoutCatalogRM,WorkoutDetailsRM,WorkoutTemplatesRM,PopularWorkoutsRM,WorkoutStatsRM,UserWorkoutsRM,WorkoutSearchRM readModel
    class ExerciseContext,ProgressionContext,UserContext,IdentityContext,NotificationContext externalContext
    class WorkoutApplicationService applicationService
    class WorkoutCommandBus,WorkoutQueryBus,WorkoutEventBus contextBus
    class WorkoutPolicyEnforcementPoint,ContentModerationService policy