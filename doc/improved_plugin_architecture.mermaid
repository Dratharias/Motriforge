graph TB
    %% ===== PLUGIN MANAGEMENT SYSTEM =====
    subgraph PluginSystem ["🔌 Plugin Management System"]
        
        %% ===== PLUGIN MANAGER LAYER =====
        subgraph PluginManagerLayer ["Plugin Manager Layer"]
            PluginManager["🔌 Plugin Manager<br/><<Manager>>"]
            PluginRegistry["📋 Plugin Registry<br/><<Registry>>"]
            PluginLoader["📂 Plugin Loader<br/><<Loader>>"]
            VersionManager["🔄 Version Manager<br/><<VersionControl>>"]
        end
        
        %% ===== SECURITY GATEWAY LAYER =====
        subgraph SecurityGatewayLayer ["Security Gateway Layer"]
            PluginSecurityGateway["🛡️ Plugin Security Gateway<br/><<SecurityGateway>>"]
            SecurityValidator["✅ Security Validator<br/><<Validator>>"]
            PluginAuditLogger["📋 Plugin Audit Logger<br/><<AuditLogger>>"]
            ThreatDetector["🚨 Threat Detector<br/><<ThreatDetection>>"]
        end
        
        %% ===== POLICY ENFORCEMENT LAYER =====
        subgraph PolicyLayer ["Policy Enforcement Layer"]
            PolicyEnforcementPoint["⚖️ Policy Enforcement Point<br/><<PEP>>"]
            PolicyDecisionPoint["🎯 Policy Decision Point<br/><<PDP>>"]
            PolicyInformationPoint["📊 Policy Information Point<br/><<PIP>>"]
            PolicyAdministrationPoint["⚙️ Policy Administration Point<br/><<PAP>>"]
        end
        
        %% ===== PLUGIN EXECUTION LAYER =====
        subgraph ExecutionLayer ["Plugin Execution Layer"]
            PluginExecutor["⚡ Plugin Executor<br/><<Executor>>"]
            SandboxManager["📦 Sandbox Manager<br/><<SandboxManager>>"]
            ResourceMonitor["📈 Resource Monitor<br/><<Monitor>>"]
            ExecutionContext["🎯 Execution Context<br/><<Context>>"]
        end
        
        %% ===== SANDBOX IMPLEMENTATIONS =====
        subgraph SandboxLayer ["Sandbox Layer"]
            WasmSandbox["🔒 WASM Sandbox<br/><<Isolation>>"]
            V8Sandbox["🔒 V8 Sandbox<br/><<Isolation>>"]
            WorkerSandbox["🔒 Worker Sandbox<br/><<Isolation>>"]
            ContainerSandbox["🔒 Container Sandbox<br/><<Isolation>>"]
        end
    end
    
    %% ===== PLUGIN TYPES =====
    subgraph PluginTypes ["🔌 Plugin Types"]
        PaymentPlugin["💳 Payment Plugin<br/><<BusinessPlugin>>"]
        AnalyticsPlugin["📊 Analytics Plugin<br/><<BusinessPlugin>>"]
        NotificationPlugin["🔔 Notification Plugin<br/><<BusinessPlugin>>"]
        AIPlugin["🤖 AI Plugin<br/><<BusinessPlugin>>"]
        CustomPlugin["🎨 Custom Plugin<br/><<BusinessPlugin>>"]
    end
    
    %% ===== SECURITY CONTEXT =====
    subgraph SecurityContext ["🔒 Security Context"]
        Identity["🆔 Identity<br/><<Identity>>"]
        Session["📋 Session<br/><<Session>>"]
        Permissions["🔑 Permissions<br/><<Permissions>>"]
        Roles["🎭 Roles<br/><<Roles>>"]
        AccessTokens["🎫 Access Tokens<br/><<Tokens>>"]
    end
    
    %% ===== INTEGRATION POINTS =====
    subgraph IntegrationPoints ["🔗 Integration Points"]
        ApplicationServiceRegistry["📋 Application Service Registry<br/><<Registry>>"]
        ContextualEventBus["📨 Contextual Event Bus<br/><<EventBus>>"]
        SharedInfrastructure["🏗️ Shared Infrastructure<br/><<Infrastructure>>"]
        ExternalAPIs["🌐 External APIs<br/><<External>>"]
    end
    
    %% ===== PLUGIN LIFECYCLE =====
    subgraph PluginLifecycle ["🔄 Plugin Lifecycle"]
        PluginDiscovery["🔍 Plugin Discovery<br/><<Discovery>>"]
        PluginValidation["✅ Plugin Validation<br/><<Validation>>"]
        PluginInstallation["📥 Plugin Installation<br/><<Installation>>"]
        PluginActivation["▶️ Plugin Activation<br/><<Activation>>"]
        PluginDeactivation["⏸️ Plugin Deactivation<br/><<Deactivation>>"]
        PluginUninstallation["🗑️ Plugin Uninstallation<br/><<Uninstallation>>"]
    end
    
    %% ===== MONITORING & OBSERVABILITY =====
    subgraph MonitoringLayer ["👁️ Monitoring & Observability"]
        PerformanceMonitor["📈 Performance Monitor<br/><<Monitor>>"]
        SecurityMonitor["🔒 Security Monitor<br/><<Monitor>>"]
        ComplianceMonitor["📋 Compliance Monitor<br/><<Monitor>>"]
        HealthChecker["❤️ Health Checker<br/><<Health>>"]
    end
    
    %% ===== PLUGIN MANAGER RELATIONSHIPS =====
    PluginManager --> PluginRegistry
    PluginManager --> PluginLoader
    PluginManager --> VersionManager
    PluginManager --> PluginSecurityGateway
    
    %% ===== SECURITY GATEWAY RELATIONSHIPS =====
    PluginSecurityGateway --> SecurityValidator
    PluginSecurityGateway --> PluginAuditLogger
    PluginSecurityGateway --> ThreatDetector
    PluginSecurityGateway --> PolicyEnforcementPoint
    
    %% ===== POLICY ENFORCEMENT RELATIONSHIPS =====
    PolicyEnforcementPoint --> PolicyDecisionPoint
    PolicyEnforcementPoint --> PolicyInformationPoint
    PolicyDecisionPoint --> PolicyAdministrationPoint
    PolicyInformationPoint --> SecurityContext
    
    %% ===== EXECUTION LAYER RELATIONSHIPS =====
    PluginSecurityGateway --> PluginExecutor
    PluginExecutor --> SandboxManager
    PluginExecutor --> ResourceMonitor
    PluginExecutor --> ExecutionContext
    
    %% ===== SANDBOX RELATIONSHIPS =====
    SandboxManager --> WasmSandbox
    SandboxManager --> V8Sandbox
    SandboxManager --> WorkerSandbox
    SandboxManager --> ContainerSandbox
    
    %% ===== PLUGIN TYPE RELATIONSHIPS =====
    PluginExecutor --> PaymentPlugin
    PluginExecutor --> AnalyticsPlugin
    PluginExecutor --> NotificationPlugin
    PluginExecutor --> AIPlugin
    PluginExecutor --> CustomPlugin
    
    %% ===== SECURITY CONTEXT RELATIONSHIPS =====
    SecurityContext --> Identity
    SecurityContext --> Session
    SecurityContext --> Permissions
    SecurityContext --> Roles
    SecurityContext --> AccessTokens
    
    %% ===== INTEGRATION RELATIONSHIPS =====
    PluginManager --> ApplicationServiceRegistry
    PluginExecutor --> ContextualEventBus
    PluginExecutor --> SharedInfrastructure
    PaymentPlugin --> ExternalAPIs
    AnalyticsPlugin --> ExternalAPIs
    NotificationPlugin --> ExternalAPIs
    AIPlugin --> ExternalAPIs
    
    %% ===== LIFECYCLE RELATIONSHIPS =====
    PluginManager --> PluginDiscovery
    PluginSecurityGateway --> PluginValidation
    PluginManager --> PluginInstallation
    PluginExecutor --> PluginActivation
    PluginExecutor --> PluginDeactivation
    PluginManager --> PluginUninstallation
    
    %% ===== MONITORING RELATIONSHIPS =====
    ResourceMonitor --> PerformanceMonitor
    PluginSecurityGateway --> SecurityMonitor
    PolicyEnforcementPoint --> ComplianceMonitor
    PluginExecutor --> HealthChecker
    
    %% ===== SECURITY FLOW =====
    PluginManager -.->|validates security| PluginSecurityGateway
    PluginSecurityGateway -.->|enforces policies| PolicyEnforcementPoint
    PolicyEnforcementPoint -.->|makes decisions| PolicyDecisionPoint
    PolicyDecisionPoint -.->|gets context| SecurityContext
    
    %% ===== EXECUTION FLOW =====
    PluginSecurityGateway -.->|authorized execution| PluginExecutor
    PluginExecutor -.->|sandboxed execution| SandboxManager
    SandboxManager -.->|isolated execution| WasmSandbox
    
    %% ===== AUDIT FLOW =====
    PluginSecurityGateway -.->|logs activity| PluginAuditLogger
    PolicyEnforcementPoint -.->|logs decisions| PluginAuditLogger
    PluginExecutor -.->|logs execution| PluginAuditLogger
    
    %% ===== STYLING =====
    classDef manager fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef security fill:#ffebee,stroke:#c62828,stroke-width:3px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    classDef execution fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
    classDef sandbox fill:#fff3e0,stroke:#ef6c00,stroke-width:3px
    classDef plugin fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef context fill:#fce4ec,stroke:#ad1457,stroke-width:2px
    classDef integration fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef lifecycle fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    classDef monitoring fill:#fff8e1,stroke:#f9a825,stroke-width:2px
    
    class PluginManager,PluginRegistry,PluginLoader,VersionManager manager
    class PluginSecurityGateway,SecurityValidator,PluginAuditLogger,ThreatDetector security
    class PolicyEnforcementPoint,PolicyDecisionPoint,PolicyInformationPoint,PolicyAdministrationPoint policy
    class PluginExecutor,SandboxManager,ResourceMonitor,ExecutionContext execution
    class WasmSandbox,V8Sandbox,WorkerSandbox,ContainerSandbox sandbox
    class PaymentPlugin,AnalyticsPlugin,NotificationPlugin,AIPlugin,CustomPlugin plugin
    class Identity,Session,Permissions,Roles,AccessTokens context
    class ApplicationServiceRegistry,ContextualEventBus,SharedInfrastructure,ExternalAPIs integration
    class PluginDiscovery,PluginValidation,PluginInstallation,PluginActivation,PluginDeactivation,PluginUninstallation lifecycle
    class PerformanceMonitor,SecurityMonitor,ComplianceMonitor,HealthChecker monitoring