graph TB
    %% ===== PROGRAM MANAGEMENT CONTEXT =====
    subgraph ProgramContext ["ğŸ“‹ Program Management Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph ProgramApplicationLayer ["Application Service Layer <<Application>>"]
            ProgramApplicationService["ğŸ“‹ Program Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph ProgramCommands ["Commands"]
                CreateProgramCmd["â• Create Program<br/><<Command>>"]
                UpdateProgramCmd["âœï¸ Update Program<br/><<Command>>"]
                AssignProgramCmd["ğŸ“Œ Assign Program<br/><<Command>>"]
                ModifyAssignmentCmd["ğŸ”§ Modify Assignment<br/><<Command>>"]
                CompleteProgramCmd["âœ… Complete Program<br/><<Command>>"]
                SaveAsTemplateCmd["ğŸ“„ Save as Template<br/><<Command>>"]
                CloneProgramCmd["ğŸ“‹ Clone Program<br/><<Command>>"]
                UpdateProgressCmd["ğŸ“ˆ Update Progress<br/><<Command>>"]
                CancelAssignmentCmd["âŒ Cancel Assignment<br/><<Command>>"]
                PublishProgramCmd["ğŸŒ Publish Program<br/><<Command>>"]
            end
            
            %% Queries
            subgraph ProgramQueries ["Queries"]
                GetProgramQuery["ğŸ“‹ Get Program<br/><<Query>>"]
                GetProgramTemplatesQuery["ğŸ“„ Get Templates<br/><<Query>>"]
                GetAssignedProgramsQuery["ğŸ“Œ Get Assigned Programs<br/><<Query>>"]
                GetProgramProgressQuery["ğŸ“ˆ Get Progress<br/><<Query>>"]
                GetProgramLibraryQuery["ğŸ“š Get Library<br/><<Query>>"]
                GetPopularProgramsQuery["â­ Get Popular<br/><<Query>>"]
                GetProgramStatsQuery["ğŸ“Š Get Stats<br/><<Query>>"]
                RecommendProgramsQuery["ğŸ¤– Recommend Programs<br/><<Query>>"]
                SearchProgramsQuery["ğŸ” Search Programs<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph ProgramSagas ["Sagas"]
                ProgramAssignmentSaga["ğŸ“Œ Program Assignment<br/><<Saga>>"]
                ProgramCompletionSaga["âœ… Program Completion<br/><<Saga>>"]
                ProgressTrackingSaga["ğŸ“ˆ Progress Tracking<br/><<Saga>>"]
                AdaptiveProgramSaga["ğŸ”„ Adaptive Program<br/><<Saga>>"]
                ProgramRecommendationSaga["ğŸ¤– Program Recommendation<br/><<Saga>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph ProgramDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Program["ğŸ“‹ Program<br/><<AggregateRoot>>"]
            ProgramTemplate["ğŸ“„ Program Template<br/><<AggregateRoot>>"]
            ProgramAssignment["ğŸ“Œ Program Assignment<br/><<AggregateRoot>>"]
            
            %% Entities
            ProgramScheduleItem["ğŸ“… Program Schedule Item<br/><<Entity>>"]
            ProgramModification["ğŸ”§ Program Modification<br/><<Entity>>"]
            
            %% Value Objects
            ProgramId["ğŸ†” Program ID<br/><<ValueObject>>"]
            ProgramName["ğŸ·ï¸ Program Name<br/><<ValueObject>>"]
            ProgramDuration["â±ï¸ Program Duration<br/><<ValueObject>>"]
            ProgressPercentage["ğŸ“ˆ Progress Percentage<br/><<ValueObject>>"]
            AdherenceScore["ğŸ“Š Adherence Score<br/><<ValueObject>>"]
            
            %% Domain Services
            ProgramDesignService["ğŸ¨ Program Design<br/><<DomainService>>"]
            AssignmentService["ğŸ“Œ Assignment<br/><<DomainService>>"]
            ProgressionService["ğŸ“ˆ Progression<br/><<DomainService>>"]
            AdherenceCalculationService["ğŸ“Š Adherence Calculation<br/><<DomainService>>"]
            ProgramRecommendationService["ğŸ¤– Program Recommendation<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph ProgramPorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IProgramRepo["ğŸ“‹ IProgramRepository<br/><<Port>>"]
            ITemplateRepo["ğŸ“„ ITemplateRepository<br/><<Port>>"]
            IAssignmentRepo["ğŸ“Œ IAssignmentRepository<br/><<Port>>"]
            IScheduleRepo["ğŸ“… IScheduleRepository<br/><<Port>>"]
            IModificationRepo["ğŸ”§ IModificationRepository<br/><<Port>>"]
            
            %% Service Ports
            IWorkoutService["ğŸ’ª IWorkoutService<br/><<Port>>"]
            IExerciseService["ğŸ¯ IExerciseService<br/><<Port>>"]
            IProgressTracker["ğŸ“ˆ IProgressTracker<br/><<Port>>"]
            INotificationService["ğŸ”” INotificationService<br/><<Port>>"]
            IAnalyticsService["ğŸ“Š IAnalyticsService<br/><<Port>>"]
            IAIRecommendationService["ğŸ¤– IAIRecommendationService<br/><<Port>>"]
            IUserService["ğŸ‘¤ IUserService<br/><<Port>>"]
            IIdentityService["ğŸ†” IIdentityService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph ProgramAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph ProgramRepositoryAdapters ["Repository Adapters"]
                MongoProgramRepo["ğŸ—„ï¸ Mongo Program Repository<br/><<RepositoryAdapter>>"]
                MongoTemplateRepo["ğŸ—„ï¸ Mongo Template Repository<br/><<RepositoryAdapter>>"]
                MongoAssignmentRepo["ğŸ—„ï¸ Mongo Assignment Repository<br/><<RepositoryAdapter>>"]
                MongoScheduleRepo["ğŸ—„ï¸ Mongo Schedule Repository<br/><<RepositoryAdapter>>"]
                MongoModificationRepo["ğŸ—„ï¸ Mongo Modification Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph ProgramServiceAdapters ["Service Adapters"]
                WorkoutContextAdapter["ğŸ’ª Workout Context<br/><<ContextAdapter>>"]
                ExerciseContextAdapter["ğŸ¯ Exercise Context<br/><<ContextAdapter>>"]
                ProgressionContextAdapter["ğŸ“ˆ Progression Context<br/><<ContextAdapter>>"]
                FCMNotificationAdapter["ğŸ“± FCM Notification<br/><<NotificationAdapter>>"]
                MixpanelAnalyticsAdapter["ğŸ“Š Mixpanel Analytics<br/><<AnalyticsAdapter>>"]
                OpenAIRecommendationAdapter["ğŸ¤– OpenAI Recommendation<br/><<AIAdapter>>"]
                UserContextAdapter["ğŸ‘¤ User Context<br/><<ContextAdapter>>"]
                IdentityContextAdapter["ğŸ†” Identity Context<br/><<ContextAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph ProgramCacheAdapters ["Cache Adapters"]
                ProgramCache["ğŸ’¾ Program Cache<br/><<CacheAdapter>>"]
                TemplateCache["ğŸ’¾ Template Cache<br/><<CacheAdapter>>"]
                AssignmentCache["ğŸ’¾ Assignment Cache<br/><<CacheAdapter>>"]
                RecommendationCache["ğŸ’¾ Recommendation Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph ProgramContextBus ["Context Bus Interfaces"]
            ProgramCommandBus["âš¡ Program Command Bus<br/><<CommandBus>>"]
            ProgramQueryBus["â“ Program Query Bus<br/><<QueryBus>>"]
            ProgramEventBus["ğŸ“¨ Program Event Bus<br/><<EventBus>>"]
        end
        
        %% ===== POLICY ENFORCEMENT =====
        subgraph ProgramPolicyLayer ["Policy Enforcement Layer"]
            ProgramPolicyEnforcementPoint["ğŸ›¡ï¸ Program Policy Enforcement Point<br/><<PEP>>"]
            ProgramAccessPolicyService["ğŸ”’ Program Access Policy<br/><<Policy>>"]
            ProgramContentPolicyService["ğŸ“‹ Program Content Policy<br/><<Policy>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph ProgramExternal ["ğŸŒ External Systems"]
        MongoDB["ğŸ—„ï¸ MongoDB<br/><<Database>>"]
        RedisCache["ğŸ”´ Redis<br/><<Cache>>"]
        FCMService["ğŸ“± FCM Service<br/><<NotificationService>>"]
        MixpanelAPI["ğŸ“Š Mixpanel API<br/><<AnalyticsService>>"]
        OpenAIAPI["ğŸ¤– OpenAI API<br/><<AIService>>"]
        ElasticsearchCluster["ğŸ” Elasticsearch<br/><<SearchEngine>>"]
        DataWarehouse["ğŸ›ï¸ Data Warehouse<br/><<Analytics>>"]
    end
    
    %% ===== EVENTS =====
    subgraph ProgramEvents ["ğŸ“¨ Domain Events"]
        ProgramCreatedEvent["ğŸ“‹ Program Created<br/><<DomainEvent>>"]
        ProgramUpdatedEvent["âœï¸ Program Updated<br/><<DomainEvent>>"]
        ProgramAssignedEvent["ğŸ“Œ Program Assigned<br/><<DomainEvent>>"]
        ProgramCompletedEvent["âœ… Program Completed<br/><<DomainEvent>>"]
        ProgramModifiedEvent["ğŸ”§ Program Modified<br/><<DomainEvent>>"]
        ProgressUpdatedEvent["ğŸ“ˆ Progress Updated<br/><<DomainEvent>>"]
        TemplateCreatedEvent["ğŸ“„ Template Created<br/><<DomainEvent>>"]
        AssignmentCancelledEvent["âŒ Assignment Cancelled<br/><<DomainEvent>>"]
        AdherenceCalculatedEvent["ğŸ“Š Adherence Calculated<br/><<DomainEvent>>"]
        ProgramPublishedEvent["ğŸŒ Program Published<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph ProgramReadModels ["ğŸ“Š Read Models"]
        ProgramLibraryRM["ğŸ“š Program Library<br/><<ReadModel>>"]
        ProgramDetailsRM["ğŸ“‹ Program Details<br/><<ReadModel>>"]
        ProgramTemplatesRM["ğŸ“„ Program Templates<br/><<ReadModel>>"]
        AssignedProgramsRM["ğŸ“Œ Assigned Programs<br/><<ReadModel>>"]
        ProgramProgressRM["ğŸ“ˆ Program Progress<br/><<ReadModel>>"]
        PopularProgramsRM["â­ Popular Programs<br/><<ReadModel>>"]
        ProgramStatsRM["ğŸ“Š Program Stats<br/><<ReadModel>>"]
        RecommendationsRM["ğŸ¤– Program Recommendations<br/><<ReadModel>>"]
        ProgramSearchRM["ğŸ” Program Search<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["ğŸŒ External Contexts"]
        WorkoutContext["ğŸ’ª Workout Context<br/><<ExternalContext>>"]
        ExerciseContext["ğŸ¯ Exercise Context<br/><<ExternalContext>>"]
        ProgressionContext["ğŸ“ˆ Progression Context<br/><<ExternalContext>>"]
        UserContext["ğŸ‘¤ User Context<br/><<ExternalContext>>"]
        IdentityContext["ğŸ†” Identity Context<br/><<ExternalContext>>"]
        NotificationContext["ğŸ”” Notification Context<br/><<ExternalContext>>"]
        TrainerContext["ğŸ‘¨â€ğŸ« Trainer Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    ProgramApplicationService --> ProgramCommandBus
    ProgramApplicationService --> ProgramQueryBus
    ProgramApplicationService --> ProgramEventBus
    
    %% Commands and Queries through Application Service
    ProgramCommands --> ProgramApplicationService
    ProgramQueries --> ProgramApplicationService
    ProgramSagas --> ProgramApplicationService
    
    %% Application Service to Domain (orchestration)
    ProgramApplicationService --> Program
    ProgramApplicationService --> ProgramTemplate
    ProgramApplicationService --> ProgramAssignment
    ProgramApplicationService --> ProgramDesignService
    ProgramApplicationService --> AssignmentService
    ProgramApplicationService --> ProgressionService
    ProgramApplicationService --> AdherenceCalculationService
    ProgramApplicationService --> ProgramRecommendationService
    
    %% Policy Enforcement Integration
    ProgramApplicationService --> ProgramPolicyEnforcementPoint
    ProgramPolicyEnforcementPoint --> ProgramAccessPolicyService
    ProgramPolicyEnforcementPoint --> ProgramContentPolicyService
    
    %% Domain to Ports (Dependency Inversion)
    Program -->|uses| IProgramRepo
    Program -->|uses| IWorkoutService
    Program -->|uses| IExerciseService
    ProgramAssignment -->|uses| IAssignmentRepo
    ProgramAssignment -->|uses| IProgressTracker
    ProgramAssignment -->|uses| INotificationService
    ProgramDesignService -->|uses| IAIRecommendationService
    AdherenceCalculationService -->|uses| IAnalyticsService
    AssignmentService -->|uses| IUserService
    AssignmentService -->|uses| IIdentityService
    
    %% Ports to Adapters (Implementation)
    IProgramRepo -.->|implements| MongoProgramRepo
    ITemplateRepo -.->|implements| MongoTemplateRepo
    IAssignmentRepo -.->|implements| MongoAssignmentRepo
    IScheduleRepo -.->|implements| MongoScheduleRepo
    IModificationRepo -.->|implements| MongoModificationRepo
    IWorkoutService -.->|implements| WorkoutContextAdapter
    IExerciseService -.->|implements| ExerciseContextAdapter
    IProgressTracker -.->|implements| ProgressionContextAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    IAnalyticsService -.->|implements| MixpanelAnalyticsAdapter
    IAIRecommendationService -.->|implements| OpenAIRecommendationAdapter
    IUserService -.->|implements| UserContextAdapter
    IIdentityService -.->|implements| IdentityContextAdapter
    
    %% Adapters to External Systems
    MongoProgramRepo -->|connects| MongoDB
    MongoTemplateRepo -->|connects| MongoDB
    MongoAssignmentRepo -->|connects| MongoDB
    MongoScheduleRepo -->|connects| MongoDB
    MongoModificationRepo -->|connects| MongoDB
    ProgramCache -->|connects| RedisCache
    TemplateCache -->|connects| RedisCache
    AssignmentCache -->|connects| RedisCache
    RecommendationCache -->|connects| RedisCache
    FCMNotificationAdapter -->|connects| FCMService
    MixpanelAnalyticsAdapter -->|connects| MixpanelAPI
    OpenAIRecommendationAdapter -->|connects| OpenAIAPI
    
    %% Cross-Context Communication
    WorkoutContextAdapter -.->|async calls| WorkoutContext
    ExerciseContextAdapter -.->|async calls| ExerciseContext
    ProgressionContextAdapter -.->|async calls| ProgressionContext
    UserContextAdapter -.->|async calls| UserContext
    IdentityContextAdapter -.->|async calls| IdentityContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    
    %% Domain Events
    Program -.->|publishes| ProgramCreatedEvent
    Program -.->|publishes| ProgramUpdatedEvent
    Program -.->|publishes| ProgramPublishedEvent
    ProgramAssignment -.->|publishes| ProgramAssignedEvent
    ProgramAssignment -.->|publishes| ProgramCompletedEvent
    ProgramModification -.->|publishes| ProgramModifiedEvent
    ProgramAssignment -.->|publishes| ProgressUpdatedEvent
    Program -.->|publishes| TemplateCreatedEvent
    ProgramAssignment -.->|publishes| AssignmentCancelledEvent
    AdherenceCalculationService -.->|publishes| AdherenceCalculatedEvent
    
    %% Event to Read Models (via Event Bus)
    ProgramEventBus -.->|projects to| ProgramLibraryRM
    ProgramEventBus -.->|projects to| ProgramDetailsRM
    ProgramEventBus -.->|projects to| ProgramTemplatesRM
    ProgramEventBus -.->|projects to| AssignedProgramsRM
    ProgramEventBus -.->|projects to| ProgramProgressRM
    ProgramEventBus -.->|projects to| PopularProgramsRM
    ProgramEventBus -.->|projects to| ProgramStatsRM
    ProgramEventBus -.->|projects to| RecommendationsRM
    ProgramEventBus -.->|projects to| ProgramSearchRM
    
    %% Events to Event Bus
    ProgramCreatedEvent -.->|publishes to| ProgramEventBus
    ProgramUpdatedEvent -.->|publishes to| ProgramEventBus
    ProgramAssignedEvent -.->|publishes to| ProgramEventBus
    ProgramCompletedEvent -.->|publishes to| ProgramEventBus
    ProgramModifiedEvent -.->|publishes to| ProgramEventBus
    ProgressUpdatedEvent -.->|publishes to| ProgramEventBus
    TemplateCreatedEvent -.->|publishes to| ProgramEventBus
    AssignmentCancelledEvent -.->|publishes to| ProgramEventBus
    AdherenceCalculatedEvent -.->|publishes to| ProgramEventBus
    ProgramPublishedEvent -.->|publishes to| ProgramEventBus
    
    %% Sagas listen to events
    ProgramAssignmentSaga -.->|listens to| ProgramAssignedEvent
    ProgramCompletionSaga -.->|listens to| ProgramCompletedEvent
    ProgressTrackingSaga -.->|listens to| ProgressUpdatedEvent
    AdaptiveProgramSaga -.->|listens to| AdherenceCalculatedEvent
    ProgramRecommendationSaga -.->|listens to| ProgramCompletedEvent
    
    %% Context Bus to External Event Bus
    ProgramEventBus -.->|integrates with| ExternalContexts
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef externalContext fill:#f5f5f5,stroke:#757575,stroke-width:2px,stroke-dasharray: 5 5
    classDef applicationService fill:#e3f2fd,stroke:#0277bd,stroke-width:4px
    classDef contextBus fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    
    class Program,ProgramTemplate,ProgramAssignment aggregate
    class ProgramScheduleItem,ProgramModification entity
    class ProgramId,ProgramName,ProgramDuration,ProgressPercentage,AdherenceScore valueObject
    class IProgramRepo,ITemplateRepo,IAssignmentRepo,IScheduleRepo,IModificationRepo,IWorkoutService,IExerciseService,IProgressTracker,INotificationService,IAnalyticsService,IAIRecommendationService,IUserService,IIdentityService port
    class MongoProgramRepo,MongoTemplateRepo,MongoAssignmentRepo,MongoScheduleRepo,MongoModificationRepo,WorkoutContextAdapter,ExerciseContextAdapter,ProgressionContextAdapter,FCMNotificationAdapter,MixpanelAnalyticsAdapter,OpenAIRecommendationAdapter,UserContextAdapter,IdentityContextAdapter,ProgramCache,TemplateCache,AssignmentCache,RecommendationCache adapter
    class MongoDB,RedisCache,FCMService,MixpanelAPI,OpenAIAPI,ElasticsearchCluster,DataWarehouse external
    class CreateProgramCmd,UpdateProgramCmd,AssignProgramCmd,ModifyAssignmentCmd,CompleteProgramCmd,SaveAsTemplateCmd,CloneProgramCmd,UpdateProgressCmd,CancelAssignmentCmd,PublishProgramCmd command
    class GetProgramQuery,GetProgramTemplatesQuery,GetAssignedProgramsQuery,GetProgramProgressQuery,GetProgramLibraryQuery,GetPopularProgramsQuery,GetProgramStatsQuery,RecommendProgramsQuery,SearchProgramsQuery query
    class ProgramCreatedEvent,ProgramUpdatedEvent,ProgramAssignedEvent,ProgramCompletedEvent,ProgramModifiedEvent,ProgressUpdatedEvent,TemplateCreatedEvent,AssignmentCancelledEvent,AdherenceCalculatedEvent,ProgramPublishedEvent event
    class ProgramLibraryRM,ProgramDetailsRM,ProgramTemplatesRM,AssignedProgramsRM,ProgramProgressRM,PopularProgramsRM,ProgramStatsRM,RecommendationsRM,ProgramSearchRM readModel
    class WorkoutContext,ExerciseContext,ProgressionContext,UserContext,IdentityContext,NotificationContext,TrainerContext externalContext
    class ProgramApplicationService applicationService
    class ProgramCommandBus,ProgramQueryBus,ProgramEventBus contextBus
    class ProgramPolicyEnforcementPoint,ProgramAccessPolicyService,ProgramContentPolicyService policy