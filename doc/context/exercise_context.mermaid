graph TB
    %% ===== EXERCISE MANAGEMENT CONTEXT =====
    subgraph ExerciseContext ["🎯 Exercise Management Context"]
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph ExerciseDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Exercise["🎯 Exercise<br/><<AggregateRoot>>"]
            ExerciseLibrary["📚 Exercise Library<br/><<AggregateRoot>>"]
            
            %% Entities
            ExerciseAlternative["🔄 Exercise Alternative<br/><<Entity>>"]
            ExerciseProgression["📈 Exercise Progression<br/><<Entity>>"]
            ExerciseSwap["🔀 Exercise Swap<br/><<Entity>>"]
            ExerciseMetric["📊 Exercise Metric<br/><<Entity>>"]
            Equipment["🛠️ Equipment<br/><<Entity>>"]
            Muscle["💪 Muscle<br/><<Entity>>"]
            MuscleGroup["💪 Muscle Group<br/><<Entity>>"]
            
            %% Value Objects
            ExerciseId["🆔 Exercise ID<br/><<ValueObject>>"]
            ExerciseName["🏷️ Exercise Name<br/><<ValueObject>>"]
            DifficultyLevel["⭐ Difficulty Level<br/><<ValueObject>>"]
            MuscleTarget["🎯 Muscle Target<br/><<ValueObject>>"]
            
            %% Domain Services
            ExerciseRecommendationService["🤖 Exercise Recommendation<br/><<DomainService>>"]
            ExerciseValidationService["✅ Exercise Validation<br/><<DomainService>>"]
            ProgressionCalculationService["📊 Progression Calculation<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph ExercisePorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IExerciseRepo["🎯 IExerciseRepository<br/><<Port>>"]
            IEquipmentRepo["🛠️ IEquipmentRepository<br/><<Port>>"]
            IMuscleRepo["💪 IMuscleRepository<br/><<Port>>"]
            IAlternativeRepo["🔄 IAlternativeRepository<br/><<Port>>"]
            IProgressionRepo["📈 IProgressionRepository<br/><<Port>>"]
            ISwapRepo["🔀 ISwapRepository<br/><<Port>>"]
            
            %% Service Ports
            IMediaStorage["📁 IMediaStorage<br/><<Port>>"]
            ISearchService["🔍 ISearchService<br/><<Port>>"]
            IAnalyticsService["📊 IAnalyticsService<br/><<Port>>"]
            IAIService["🤖 IAIService<br/><<Port>>"]
        end
        
        %% ===== APPLICATION LAYER =====
        subgraph ExerciseApplication ["Application Layer <<Application>>"]
            direction TB
            
            %% Commands
            subgraph ExerciseCommands ["Commands"]
                CreateExerciseCmd["➕ Create Exercise<br/><<Command>>"]
                UpdateExerciseCmd["✏️ Update Exercise<br/><<Command>>"]
                AddAlternativeCmd["🔄 Add Alternative<br/><<Command>>"]
                AddProgressionCmd["📈 Add Progression<br/><<Command>>"]
                SwapExerciseCmd["🔀 Swap Exercise<br/><<Command>>"]
                AddEquipmentCmd["🛠️ Add Equipment<br/><<Command>>"]
                UploadMediaCmd["📁 Upload Media<br/><<Command>>"]
            end
            
            %% Queries
            subgraph ExerciseQueries ["Queries"]
                GetExerciseQuery["🎯 Get Exercise<br/><<Query>>"]
                SearchExercisesQuery["🔍 Search Exercises<br/><<Query>>"]
                GetAlternativesQuery["🔄 Get Alternatives<br/><<Query>>"]
                GetProgressionsQuery["📈 Get Progressions<br/><<Query>>"]
                GetEquipmentQuery["🛠️ Get Equipment<br/><<Query>>"]
                GetMuscleGroupsQuery["💪 Get Muscle Groups<br/><<Query>>"]
                RecommendExercisesQuery["🤖 Recommend Exercises<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph ExerciseSagas ["Sagas"]
                ExerciseCreationSaga["🎯 Exercise Creation<br/><<Saga>>"]
                MediaProcessingSaga["📁 Media Processing<br/><<Saga>>"]
                RecommendationUpdateSaga["🤖 Recommendation Update<br/><<Saga>>"]
            end
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph ExerciseAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph ExerciseRepositoryAdapters ["Repository Adapters"]
                MongoExerciseRepo["🗄️ Mongo Exercise Repository<br/><<RepositoryAdapter>>"]
                MongoEquipmentRepo["🗄️ Mongo Equipment Repository<br/><<RepositoryAdapter>>"]
                MongoMuscleRepo["🗄️ Mongo Muscle Repository<br/><<RepositoryAdapter>>"]
                MongoAlternativeRepo["🗄️ Mongo Alternative Repository<br/><<RepositoryAdapter>>"]
                MongoProgressionRepo["🗄️ Mongo Progression Repository<br/><<RepositoryAdapter>>"]
                MongoSwapRepo["🗄️ Mongo Swap Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph ExerciseServiceAdapters ["Service Adapters"]
                S3MediaAdapter["☁️ S3 Media Storage<br/><<StorageAdapter>>"]
                ElasticSearchAdapter["🔍 Elasticsearch<br/><<SearchAdapter>>"]
                MixpanelAnalyticsAdapter["📊 Mixpanel Analytics<br/><<AnalyticsAdapter>>"]
                OpenAIAdapter["🤖 OpenAI<br/><<AIAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph ExerciseCacheAdapters ["Cache Adapters"]
                ExerciseCache["💾 Exercise Cache<br/><<CacheAdapter>>"]
                SearchCache["💾 Search Cache<br/><<CacheAdapter>>"]
                RecommendationCache["💾 Recommendation Cache<br/><<CacheAdapter>>"]
            end
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph ExerciseExternal ["🌐 External Systems"]
        MongoDB["🗄️ MongoDB<br/><<Database>>"]
        RedisCache["🔴 Redis<br/><<Cache>>"]
        S3Bucket["☁️ S3 Bucket<br/><<Storage>>"]
        ElasticsearchCluster["🔍 Elasticsearch<br/><<SearchEngine>>"]
        MixpanelAPI["📊 Mixpanel API<br/><<AnalyticsService>>"]
        OpenAIAPI["🤖 OpenAI API<br/><<AIService>>"]
        CDN["🌐 CDN<br/><<ContentDelivery>>"]
    end
    
    %% ===== EVENTS =====
    subgraph ExerciseEvents ["📨 Domain Events"]
        ExerciseCreatedEvent["🎯 Exercise Created<br/><<DomainEvent>>"]
        ExerciseUpdatedEvent["✏️ Exercise Updated<br/><<DomainEvent>>"]
        AlternativeAddedEvent["🔄 Alternative Added<br/><<DomainEvent>>"]
        ProgressionAddedEvent["📈 Progression Added<br/><<DomainEvent>>"]
        ExerciseSwappedEvent["🔀 Exercise Swapped<br/><<DomainEvent>>"]
        MediaUploadedEvent["📁 Media Uploaded<br/><<DomainEvent>>"]
        EquipmentAddedEvent["🛠️ Equipment Added<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph ExerciseReadModels ["📊 Read Models"]
        ExerciseLibraryRM["📚 Exercise Library<br/><<ReadModel>>"]
        ExerciseDetailsRM["🎯 Exercise Details<br/><<ReadModel>>"]
        EquipmentCatalogRM["🛠️ Equipment Catalog<br/><<ReadModel>>"]
        MuscleGroupsRM["💪 Muscle Groups<br/><<ReadModel>>"]
        ExerciseStatsRM["📊 Exercise Stats<br/><<ReadModel>>"]
        RecommendationsRM["🤖 Exercise Recommendations<br/><<ReadModel>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Domain to Ports (Dependency Inversion)
    Exercise -->|uses| IExerciseRepo
    Exercise -->|uses| IMediaStorage
    Exercise -->|uses| ISearchService
    ExerciseLibrary -->|uses| IEquipmentRepo
    ExerciseLibrary -->|uses| IMuscleRepo
    ExerciseRecommendationService -->|uses| IAIService
    ExerciseRecommendationService -->|uses| IAnalyticsService
    
    %% Application to Domain
    ExerciseCommands -->|orchestrates| Exercise
    ExerciseCommands -->|orchestrates| ExerciseLibrary
    ExerciseQueries -->|reads| Exercise
    ExerciseQueries -->|reads| ExerciseLibrary
    
    %% Ports to Adapters (Implementation)
    IExerciseRepo -.->|implements| MongoExerciseRepo
    IEquipmentRepo -.->|implements| MongoEquipmentRepo
    IMuscleRepo -.->|implements| MongoMuscleRepo
    IAlternativeRepo -.->|implements| MongoAlternativeRepo
    IProgressionRepo -.->|implements| MongoProgressionRepo
    ISwapRepo -.->|implements| MongoSwapRepo
    IMediaStorage -.->|implements| S3MediaAdapter
    ISearchService -.->|implements| ElasticSearchAdapter
    IAnalyticsService -.->|implements| MixpanelAnalyticsAdapter
    IAIService -.->|implements| OpenAIAdapter
    
    %% Adapters to External Systems
    MongoExerciseRepo -->|connects| MongoDB
    MongoEquipmentRepo -->|connects| MongoDB
    MongoMuscleRepo -->|connects| MongoDB
    MongoAlternativeRepo -->|connects| MongoDB
    MongoProgressionRepo -->|connects| MongoDB
    MongoSwapRepo -->|connects| MongoDB
    ExerciseCache -->|connects| RedisCache
    SearchCache -->|connects| RedisCache
    RecommendationCache -->|connects| RedisCache
    S3MediaAdapter -->|connects| S3Bucket
    S3MediaAdapter -->|serves via| CDN
    ElasticSearchAdapter -->|connects| ElasticsearchCluster
    MixpanelAnalyticsAdapter -->|connects| MixpanelAPI
    OpenAIAdapter -->|connects| OpenAIAPI
    
    %% Domain Events
    Exercise -.->|publishes| ExerciseCreatedEvent
    Exercise -.->|publishes| ExerciseUpdatedEvent
    Exercise -.->|publishes| MediaUploadedEvent
    ExerciseAlternative -.->|publishes| AlternativeAddedEvent
    ExerciseProgression -.->|publishes| ProgressionAddedEvent
    ExerciseSwap -.->|publishes| ExerciseSwappedEvent
    Equipment -.->|publishes| EquipmentAddedEvent
    
    %% Event to Read Models
    ExerciseCreatedEvent -.->|projects to| ExerciseLibraryRM
    ExerciseUpdatedEvent -.->|projects to| ExerciseDetailsRM
    AlternativeAddedEvent -.->|projects to| ExerciseDetailsRM
    ProgressionAddedEvent -.->|projects to| ExerciseDetailsRM
    EquipmentAddedEvent -.->|projects to| EquipmentCatalogRM
    ExerciseSwappedEvent -.->|projects to| ExerciseStatsRM
    
    %% Sagas
    ExerciseCreationSaga -.->|listens to| ExerciseCreatedEvent
    MediaProcessingSaga -.->|listens to| MediaUploadedEvent
    RecommendationUpdateSaga -.->|listens to| ExerciseCreatedEvent
    RecommendationUpdateSaga -.->|listens to| ExerciseUpdatedEvent
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    
    class Exercise,ExerciseLibrary aggregate
    class ExerciseAlternative,ExerciseProgression,ExerciseSwap,ExerciseMetric,Equipment,Muscle,MuscleGroup entity
    class ExerciseId,ExerciseName,DifficultyLevel,MuscleTarget valueObject
    class IExerciseRepo,IEquipmentRepo,IMuscleRepo,IAlternativeRepo,IProgressionRepo,ISwapRepo,IMediaStorage,ISearchService,IAnalyticsService,IAIService port
    class MongoExerciseRepo,MongoEquipmentRepo,MongoMuscleRepo,MongoAlternativeRepo,MongoProgressionRepo,MongoSwapRepo,S3MediaAdapter,ElasticSearchAdapter,MixpanelAnalyticsAdapter,OpenAIAdapter,ExerciseCache,SearchCache,RecommendationCache adapter
    class MongoDB,RedisCache,S3Bucket,ElasticsearchCluster,MixpanelAPI,OpenAIAPI,CDN external
    class CreateExerciseCmd,UpdateExerciseCmd,AddAlternativeCmd,AddProgressionCmd,SwapExerciseCmd,AddEquipmentCmd,UploadMediaCmd command
    class GetExerciseQuery,SearchExercisesQuery,GetAlternativesQuery,GetProgressionsQuery,GetEquipmentQuery,GetMuscleGroupsQuery,RecommendExercisesQuery query
    class ExerciseCreatedEvent,ExerciseUpdatedEvent,AlternativeAddedEvent,ProgressionAddedEvent,ExerciseSwappedEvent,MediaUploadedEvent,EquipmentAddedEvent event
    class ExerciseLibraryRM,ExerciseDetailsRM,EquipmentCatalogRM,MuscleGroupsRM,ExerciseStatsRM,RecommendationsRM readModel