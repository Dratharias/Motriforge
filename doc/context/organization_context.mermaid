graph TB
    %% ===== ENHANCED ORGANIZATION MANAGEMENT CONTEXT =====
    subgraph OrgContext ["🏢 Enhanced Organization Management Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph OrgApplicationLayer ["Application Service Layer <<Application>>"]
            OrgApplicationService["🏢 Organization Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph OrgCommands ["Commands"]
                CreateOrgCmd["➕ Create Organization<br/><<Command>>"]
                UpdateOrgCmd["✏️ Update Organization<br/><<Command>>"]
                DeactivateOrgCmd["🚫 Deactivate Organization<br/><<Command>>"]
                AddMemberCmd["👤 Add Member<br/><<Command>>"]
                RemoveMemberCmd["➖ Remove Member<br/><<Command>>"]
                UpdateMemberRoleCmd["🎭 Update Member Role<br/><<Command>>"]
                InviteMemberCmd["📨 Invite Member<br/><<Command>>"]
                AcceptInvitationCmd["✅ Accept Invitation<br/><<Command>>"]
                RevokeInvitationCmd["❌ Revoke Invitation<br/><<Command>>"]
                UpdateSettingsCmd["⚙️ Update Settings<br/><<Command>>"]
                ManagePermissionsCmd["🔒 Manage Permissions<br/><<Command>>"]
                CreateDepartmentCmd["🏛️ Create Department<br/><<Command>>"]
                AssignToSubscriptionCmd["💳 Assign Subscription<br/><<Command>>"]
            end
            
            %% Queries
            subgraph OrgQueries ["Queries"]
                GetOrgQuery["🏢 Get Organization<br/><<Query>>"]
                GetMembersQuery["👥 Get Members<br/><<Query>>"]
                GetInvitationsQuery["📨 Get Invitations<br/><<Query>>"]
                GetOrgStatsQuery["📊 Get Org Stats<br/><<Query>>"]
                GetUserOrgsQuery["👤 Get User Orgs<br/><<Query>>"]
                GetPermissionsQuery["🔒 Get Permissions<br/><<Query>>"]
                GetDepartmentsQuery["🏛️ Get Departments<br/><<Query>>"]
                GetOrgHierarchyQuery["🌳 Get Org Hierarchy<br/><<Query>>"]
                GetSubscriptionStatusQuery["💳 Get Subscription Status<br/><<Query>>"]
                SearchOrganizationsQuery["🔍 Search Organizations<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph OrgSagas ["Sagas"]
                OrgSetupSaga["🎯 Organization Setup<br/><<Saga>>"]
                MemberInvitationSaga["📨 Member Invitation<br/><<Saga>>"]
                OrgDeactivationSaga["🚫 Org Deactivation<br/><<Saga>>"]
                PermissionSyncSaga["🔄 Permission Sync<br/><<Saga>>"]
                SubscriptionManagementSaga["💳 Subscription Management<br/><<Saga>>"]
                ComplianceAuditSaga["📋 Compliance Audit<br/><<Saga>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph OrgDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Organization["🏢 Organization<br/><<AggregateRoot>>"]
            OrganizationMembership["👥 Organization Membership<br/><<AggregateRoot>>"]
            OrgPermissionMatrix["🔒 Permission Matrix<br/><<AggregateRoot>>"]
            OrganizationSubscription["💳 Organization Subscription<br/><<AggregateRoot>>"]
            
            %% Entities
            OrganizationMember["👤 Organization Member<br/><<Entity>>"]
            Invitation["📨 Invitation<br/><<Entity>>"]
            OrgSettings["⚙️ Settings<br/><<Entity>>"]
            Contact["📞 Contact<br/><<Entity>>"]
            Department["🏛️ Department<br/><<Entity>>"]
            OrgRole["🎭 Organization Role<br/><<Entity>>"]
            Permission["🔒 Permission<br/><<Entity>>"]
            SubscriptionPlan["📋 Subscription Plan<br/><<Entity>>"]
            BillingInfo["💳 Billing Information<br/><<Entity>>"]
            
            %% Value Objects
            OrgId["🆔 Organization ID<br/><<ValueObject>>"]
            OrgName["🏢 Organization Name<br/><<ValueObject>>"]
            MemberRole["🎭 Member Role<br/><<ValueObject>>"]
            InvitationToken["🎫 Invitation Token<br/><<ValueObject>>"]
            PermissionScope["🎯 Permission Scope<br/><<ValueObject>>"]
            SubscriptionStatus["📊 Subscription Status<br/><<ValueObject>>"]
            TrustLevel["⭐ Trust Level<br/><<ValueObject>>"]
            
            %% Domain Services
            MembershipService["👥 Membership Service<br/><<DomainService>>"]
            InvitationService["📨 Invitation Service<br/><<DomainService>>"]
            OrgValidationService["✅ Organization Validation<br/><<DomainService>>"]
            PermissionManagementService["🔒 Permission Management<br/><<DomainService>>"]
            HierarchyService["🌳 Hierarchy Service<br/><<DomainService>>"]
            SubscriptionService["💳 Subscription Service<br/><<DomainService>>"]
            ComplianceService["📋 Compliance Service<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph OrgPorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IOrganizationRepo["🏢 IOrganizationRepository<br/><<Port>>"]
            IMemberRepo["👥 IMemberRepository<br/><<Port>>"]
            IInvitationRepo["📨 IInvitationRepository<br/><<Port>>"]
            ISettingsRepo["⚙️ ISettingsRepository<br/><<Port>>"]
            IPermissionRepo["🔒 IPermissionRepository<br/><<Port>>"]
            IDepartmentRepo["🏛️ IDepartmentRepository<br/><<Port>>"]
            ISubscriptionRepo["💳 ISubscriptionRepository<br/><<Port>>"]
            
            %% Service Ports
            IEmailService["📧 IEmailService<br/><<Port>>"]
            IPermissionService["🔒 IPermissionService<br/><<Port>>"]
            IBillingService["💳 IBillingService<br/><<Port>>"]
            IAnalyticsService["📊 IAnalyticsService<br/><<Port>>"]
            IIdentityService["🆔 IIdentityService<br/><<Port>>"]
            IUserService["👤 IUserService<br/><<Port>>"]
            INotificationService["🔔 INotificationService<br/><<Port>>"]
            IAuditService["📋 IAuditService<br/><<Port>>"]
            IComplianceService["📋 IComplianceService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph OrgAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph OrgRepositoryAdapters ["Repository Adapters"]
                MongoOrgRepo["🗄️ Mongo Organization Repository<br/><<RepositoryAdapter>>"]
                MongoMemberRepo["🗄️ Mongo Member Repository<br/><<RepositoryAdapter>>"]
                MongoInvitationRepo["🗄️ Mongo Invitation Repository<br/><<RepositoryAdapter>>"]
                MongoSettingsRepo["🗄️ Mongo Settings Repository<br/><<RepositoryAdapter>>"]
                MongoPermissionRepo["🗄️ Mongo Permission Repository<br/><<RepositoryAdapter>>"]
                MongoDepartmentRepo["🗄️ Mongo Department Repository<br/><<RepositoryAdapter>>"]
                MongoSubscriptionRepo["🗄️ Mongo Subscription Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph OrgServiceAdapters ["Service Adapters"]
                SendGridEmailAdapter["📧 SendGrid Email<br/><<EmailAdapter>>"]
                Auth0PermissionAdapter["🔒 Auth0 Permission<br/><<PermissionAdapter>>"]
                StripeBillingAdapter["💳 Stripe Billing<br/><<BillingAdapter>>"]
                MixpanelAnalyticsAdapter["📊 Mixpanel Analytics<br/><<AnalyticsAdapter>>"]
                IdentityContextAdapter["🆔 Identity Context<br/><<ContextAdapter>>"]
                UserContextAdapter["👤 User Context<br/><<ContextAdapter>>"]
                FCMNotificationAdapter["📱 FCM Notification<br/><<NotificationAdapter>>"]
                ComplianceAuditAdapter["📋 Compliance Audit<br/><<AuditAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph OrgCacheAdapters ["Cache Adapters"]
                OrgCache["💾 Organization Cache<br/><<CacheAdapter>>"]
                MemberCache["💾 Member Cache<br/><<CacheAdapter>>"]
                PermissionCache["💾 Permission Cache<br/><<CacheAdapter>>"]
                HierarchyCache["💾 Hierarchy Cache<br/><<CacheAdapter>>"]
                SubscriptionCache["💾 Subscription Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph OrgContextBus ["Context Bus Interfaces"]
            OrgCommandBus["⚡ Org Command Bus<br/><<CommandBus>>"]
            OrgQueryBus["❓ Org Query Bus<br/><<QueryBus>>"]
            OrgEventBus["📨 Org Event Bus<br/><<EventBus>>"]
        end
        
        %% ===== POLICY ENFORCEMENT =====
        subgraph OrgPolicyLayer ["Policy Enforcement Layer"]
            OrgPolicyEnforcementPoint["🛡️ Org Policy Enforcement Point<br/><<PEP>>"]
            OrganizationAccessPolicyService["🔒 Organization Access Policy<br/><<Policy>>"]
            MembershipPolicyService["👥 Membership Policy<br/><<Policy>>"]
            DataGovernancePolicyService["📋 Data Governance Policy<br/><<Policy>>"]
            CompliancePolicyService["⚖️ Compliance Policy<br/><<Policy>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph OrgExternal ["🌐 External Systems"]
        MongoDB["🗄️ MongoDB<br/><<Database>>"]
        RedisCache["🔴 Redis<br/><<Cache>>"]
        SendGridAPI["📧 SendGrid API<br/><<EmailService>>"]
        Auth0API["🔒 Auth0 API<br/><<AuthService>>"]
        StripeAPI["💳 Stripe API<br/><<PaymentService>>"]
        MixpanelAPI["📊 Mixpanel API<br/><<AnalyticsService>>"]
        FCMService["📱 FCM Service<br/><<NotificationService>>"]
        ComplianceDB["📋 Compliance Database<br/><<ComplianceSystem>>"]
        AuditLogService["📋 Audit Log Service<br/><<AuditSystem>>"]
    end
    
    %% ===== EVENTS =====
    subgraph OrgEvents ["📨 Domain Events"]
        OrgCreatedEvent["🏢 Organization Created<br/><<DomainEvent>>"]
        OrgUpdatedEvent["✏️ Organization Updated<br/><<DomainEvent>>"]
        OrgDeactivatedEvent["🚫 Organization Deactivated<br/><<DomainEvent>>"]
        MemberAddedEvent["👤 Member Added<br/><<DomainEvent>>"]
        MemberRemovedEvent["➖ Member Removed<br/><<DomainEvent>>"]
        RoleChangedEvent["🎭 Role Changed<br/><<DomainEvent>>"]
        InvitationSentEvent["📨 Invitation Sent<br/><<DomainEvent>>"]
        InvitationAcceptedEvent["✅ Invitation Accepted<br/><<DomainEvent>>"]
        InvitationRevokedEvent["❌ Invitation Revoked<br/><<DomainEvent>>"]
        SettingsUpdatedEvent["⚙️ Settings Updated<br/><<DomainEvent>>"]
        PermissionsChangedEvent["🔒 Permissions Changed<br/><<DomainEvent>>"]
        DepartmentCreatedEvent["🏛️ Department Created<br/><<DomainEvent>>"]
        SubscriptionChangedEvent["💳 Subscription Changed<br/><<DomainEvent>>"]
        ComplianceViolationEvent["⚠️ Compliance Violation<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph OrgReadModels ["📊 Read Models"]
        OrgDashboardRM["🏢 Organization Dashboard<br/><<ReadModel>>"]
        MemberListRM["👥 Member List<br/><<ReadModel>>"]
        OrgStatsRM["📊 Organization Stats<br/><<ReadModel>>"]
        InvitationListRM["📨 Invitation List<br/><<ReadModel>>"]
        UserOrgsRM["👤 User Organizations<br/><<ReadModel>>"]
        PermissionMatrixRM["🔒 Permission Matrix<br/><<ReadModel>>"]
        OrgHierarchyRM["🌳 Organization Hierarchy<br/><<ReadModel>>"]
        DepartmentListRM["🏛️ Department List<br/><<ReadModel>>"]
        SubscriptionDashboardRM["💳 Subscription Dashboard<br/><<ReadModel>>"]
        ComplianceReportRM["📋 Compliance Report<br/><<ReadModel>>"]
        OrgSearchRM["🔍 Organization Search<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["🌐 External Contexts"]
        UserContext["👤 User Context<br/><<ExternalContext>>"]
        IdentityContext["🆔 Identity Context<br/><<ExternalContext>>"]
        NotificationContext["🔔 Notification Context<br/><<ExternalContext>>"]
        AuthenticationContext["🔐 Authentication Context<br/><<ExternalContext>>"]
        AuditContext["📋 Audit Context<br/><<ExternalContext>>"]
        BillingContext["💳 Billing Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    OrgApplicationService --> OrgCommandBus
    OrgApplicationService --> OrgQueryBus
    OrgApplicationService --> OrgEventBus
    
    %% Commands and Queries through Application Service
    OrgCommands --> OrgApplicationService
    OrgQueries --> OrgApplicationService
    OrgSagas --> OrgApplicationService
    
    %% Application Service to Domain (orchestration)
    OrgApplicationService --> Organization
    OrgApplicationService --> OrganizationMembership
    OrgApplicationService --> OrgPermissionMatrix
    OrgApplicationService --> OrganizationSubscription
    OrgApplicationService --> MembershipService
    OrgApplicationService --> InvitationService
    OrgApplicationService --> OrgValidationService
    OrgApplicationService --> PermissionManagementService
    OrgApplicationService --> HierarchyService
    OrgApplicationService --> SubscriptionService
    OrgApplicationService --> ComplianceService
    
    %% Policy Enforcement Integration
    OrgApplicationService --> OrgPolicyEnforcementPoint
    OrgPolicyEnforcementPoint --> OrganizationAccessPolicyService
    OrgPolicyEnforcementPoint --> MembershipPolicyService
    OrgPolicyEnforcementPoint --> DataGovernancePolicyService
    OrgPolicyEnforcementPoint --> CompliancePolicyService
    
    %% Domain to Ports (Dependency Inversion)
    Organization -->|uses| IOrganizationRepo
    Organization -->|uses| IEmailService
    Organization -->|uses| IBillingService
    Organization -->|uses| IAuditService
    OrganizationMembership -->|uses| IMemberRepo
    OrganizationMembership -->|uses| IPermissionService
    OrgPermissionMatrix -->|uses| IPermissionRepo
    OrganizationSubscription -->|uses| ISubscriptionRepo
    MembershipService -->|uses| IAnalyticsService
    InvitationService -->|uses| IInvitationRepo
    InvitationService -->|uses| INotificationService
    PermissionManagementService -->|uses| IIdentityService
    SubscriptionService -->|uses| IUserService
    ComplianceService -->|uses| IComplianceService
    
    %% Ports to Adapters (Implementation)
    IOrganizationRepo -.->|implements| MongoOrgRepo
    IMemberRepo -.->|implements| MongoMemberRepo
    IInvitationRepo -.->|implements| MongoInvitationRepo
    ISettingsRepo -.->|implements| MongoSettingsRepo
    IPermissionRepo -.->|implements| MongoPermissionRepo
    IDepartmentRepo -.->|implements| MongoDepartmentRepo
    ISubscriptionRepo -.->|implements| MongoSubscriptionRepo
    IEmailService -.->|implements| SendGridEmailAdapter
    IPermissionService -.->|implements| Auth0PermissionAdapter
    IBillingService -.->|implements| StripeBillingAdapter
    IAnalyticsService -.->|implements| MixpanelAnalyticsAdapter
    IIdentityService -.->|implements| IdentityContextAdapter
    IUserService -.->|implements| UserContextAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    IAuditService -.->|implements| ComplianceAuditAdapter
    IComplianceService -.->|implements| ComplianceAuditAdapter
    
    %% Adapters to External Systems
    MongoOrgRepo -->|connects| MongoDB
    MongoMemberRepo -->|connects| MongoDB
    MongoInvitationRepo -->|connects| MongoDB
    MongoSettingsRepo -->|connects| MongoDB
    MongoPermissionRepo -->|connects| MongoDB
    MongoDepartmentRepo -->|connects| MongoDB
    MongoSubscriptionRepo -->|connects| MongoDB
    OrgCache -->|connects| RedisCache
    MemberCache -->|connects| RedisCache
    PermissionCache -->|connects| RedisCache
    HierarchyCache -->|connects| RedisCache
    SubscriptionCache -->|connects| RedisCache
    SendGridEmailAdapter -->|connects| SendGridAPI
    Auth0PermissionAdapter -->|connects| Auth0API
    StripeBillingAdapter -->|connects| StripeAPI
    MixpanelAnalyticsAdapter -->|connects| MixpanelAPI
    FCMNotificationAdapter -->|connects| FCMService
    ComplianceAuditAdapter -->|connects| ComplianceDB
    ComplianceAuditAdapter -->|connects| AuditLogService
    
    %% Cross-Context Communication
    IdentityContextAdapter -.->|async calls| IdentityContext
    UserContextAdapter -.->|async calls| UserContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    ComplianceAuditAdapter -.->|async calls| AuditContext
    StripeBillingAdapter -.->|async calls| BillingContext
    
    %% Domain Events
    Organization -.->|publishes| OrgCreatedEvent
    Organization -.->|publishes| OrgUpdatedEvent
    Organization -.->|publishes| OrgDeactivatedEvent
    Organization -.->|publishes| SettingsUpdatedEvent
    OrganizationMembership -.->|publishes| MemberAddedEvent
    OrganizationMembership -.->|publishes| MemberRemovedEvent
    OrganizationMembership -.->|publishes| RoleChangedEvent
    InvitationService -.->|publishes| InvitationSentEvent
    InvitationService -.->|publishes| InvitationAcceptedEvent
    InvitationService -.->|publishes| InvitationRevokedEvent
    OrgPermissionMatrix -.->|publishes| PermissionsChangedEvent
    Department -.->|publishes| DepartmentCreatedEvent
    OrganizationSubscription -.->|publishes| SubscriptionChangedEvent
    ComplianceService -.->|publishes| ComplianceViolationEvent
    
    %% Event to Read Models (via Event Bus)
    OrgEventBus -.->|projects to| OrgDashboardRM
    OrgEventBus -.->|projects to| MemberListRM
    OrgEventBus -.->|projects to| OrgStatsRM
    OrgEventBus -.->|projects to| InvitationListRM
    OrgEventBus -.->|projects to| UserOrgsRM
    OrgEventBus -.->|projects to| PermissionMatrixRM
    OrgEventBus -.->|projects to| OrgHierarchyRM
    OrgEventBus -.->|projects to| DepartmentListRM
    OrgEventBus -.->|projects to| SubscriptionDashboardRM
    OrgEventBus -.->|projects to| ComplianceReportRM
    OrgEventBus -.->|projects to| OrgSearchRM
    
    %% Events to Event Bus
    OrgCreatedEvent -.->|publishes to| OrgEventBus
    OrgUpdatedEvent -.->|publishes to| OrgEventBus
    OrgDeactivatedEvent -.->|publishes to| OrgEventBus
    MemberAddedEvent -.->|publishes to| OrgEventBus
    MemberRemovedEvent -.->|publishes to| OrgEventBus
    RoleChangedEvent -.->|publishes to| OrgEventBus
    InvitationSentEvent -.->|publishes to| OrgEventBus
    InvitationAcceptedEvent -.->|publishes to| OrgEventBus
    InvitationRevokedEvent -.->|publishes to| OrgEventBus
    SettingsUpdatedEvent -.->|publishes to| OrgEventBus
    PermissionsChangedEvent -.->|publishes to| OrgEventBus
    DepartmentCreatedEvent -.->|publishes to| OrgEventBus
    SubscriptionChangedEvent -.->|publishes to| OrgEventBus
    ComplianceViolationEvent -.->|publishes to| OrgEventBus
    
    %% Sagas listen to events
    OrgSetupSaga -.->|listens to| OrgCreatedEvent
    MemberInvitationSaga -.->|listens to| InvitationSentEvent
    MemberInvitationSaga -.->|listens to| InvitationAcceptedEvent
    OrgDeactivationSaga -.->|listens to| OrgDeactivatedEvent
    PermissionSyncSaga -.->|listens to| PermissionsChangedEvent
    SubscriptionManagementSaga -.->|listens to| SubscriptionChangedEvent
    ComplianceAuditSaga -.->|listens to| ComplianceViolationEvent
    
    %% Context Bus to External Event Bus
    OrgEventBus -.->|integrates with| ExternalContexts