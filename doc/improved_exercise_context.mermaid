graph TB
    %% ===== EXERCISE MANAGEMENT CONTEXT =====
    subgraph ExerciseContext ["ğŸ¯ Exercise Management Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph ExerciseApplicationLayer ["Application Service Layer <<Application>>"]
            ExerciseApplicationService["ğŸ¯ Exercise Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph ExerciseCommands ["Commands"]
                CreateExerciseCmd["â• Create Exercise<br/><<Command>>"]
                UpdateExerciseCmd["âœï¸ Update Exercise<br/><<Command>>"]
                AddAlternativeCmd["ğŸ”„ Add Alternative<br/><<Command>>"]
                AddProgressionCmd["ğŸ“ˆ Add Progression<br/><<Command>>"]
                SwapExerciseCmd["ğŸ”€ Swap Exercise<br/><<Command>>"]
                AddEquipmentCmd["ğŸ› ï¸ Add Equipment<br/><<Command>>"]
                UploadMediaCmd["ğŸ“ Upload Media<br/><<Command>>"]
                ApproveExerciseCmd["âœ… Approve Exercise<br/><<Command>>"]
                FlagExerciseCmd["ğŸš© Flag Exercise<br/><<Command>>"]
            end
            
            %% Queries
            subgraph ExerciseQueries ["Queries"]
                GetExerciseQuery["ğŸ¯ Get Exercise<br/><<Query>>"]
                SearchExercisesQuery["ğŸ” Search Exercises<br/><<Query>>"]
                GetAlternativesQuery["ğŸ”„ Get Alternatives<br/><<Query>>"]
                GetProgressionsQuery["ğŸ“ˆ Get Progressions<br/><<Query>>"]
                GetEquipmentQuery["ğŸ› ï¸ Get Equipment<br/><<Query>>"]
                GetMuscleGroupsQuery["ğŸ’ª Get Muscle Groups<br/><<Query>>"]
                RecommendExercisesQuery["ğŸ¤– Recommend Exercises<br/><<Query>>"]
                GetExerciseStatsQuery["ğŸ“Š Get Exercise Stats<br/><<Query>>"]
            end
            
            %% Sagas
            subgraph ExerciseSagas ["Sagas"]
                ExerciseCreationSaga["ğŸ¯ Exercise Creation<br/><<Saga>>"]
                MediaProcessingSaga["ğŸ“ Media Processing<br/><<Saga>>"]
                RecommendationUpdateSaga["ğŸ¤– Recommendation Update<br/><<Saga>>"]
                ExerciseApprovalSaga["âœ… Exercise Approval<br/><<Saga>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph ExerciseDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Exercise["ğŸ¯ Exercise<br/><<AggregateRoot>>"]
            ExerciseLibrary["ğŸ“š Exercise Library<br/><<AggregateRoot>>"]
            
            %% Entities
            ExerciseAlternative["ğŸ”„ Exercise Alternative<br/><<Entity>>"]
            ExerciseProgression["ğŸ“ˆ Exercise Progression<br/><<Entity>>"]
            ExerciseSwap["ğŸ”€ Exercise Swap<br/><<Entity>>"]
            ExerciseMetric["ğŸ“Š Exercise Metric<br/><<Entity>>"]
            Equipment["ğŸ› ï¸ Equipment<br/><<Entity>>"]
            Muscle["ğŸ’ª Muscle<br/><<Entity>>"]
            MuscleGroup["ğŸ’ª Muscle Group<br/><<Entity>>"]
            
            %% Value Objects
            ExerciseId["ğŸ†” Exercise ID<br/><<ValueObject>>"]
            ExerciseName["ğŸ·ï¸ Exercise Name<br/><<ValueObject>>"]
            DifficultyLevel["â­ Difficulty Level<br/><<ValueObject>>"]
            MuscleTarget["ğŸ¯ Muscle Target<br/><<ValueObject>>"]
            
            %% Domain Services
            ExerciseRecommendationService["ğŸ¤– Exercise Recommendation<br/><<DomainService>>"]
            ExerciseValidationService["âœ… Exercise Validation<br/><<DomainService>>"]
            ProgressionCalculationService["ğŸ“Š Progression Calculation<br/><<DomainService>>"]
            ExerciseApprovalService["âœ… Exercise Approval<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph ExercisePorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IExerciseRepo["ğŸ¯ IExerciseRepository<br/><<Port>>"]
            IEquipmentRepo["ğŸ› ï¸ IEquipmentRepository<br/><<Port>>"]
            IMuscleRepo["ğŸ’ª IMuscleRepository<br/><<Port>>"]
            IAlternativeRepo["ğŸ”„ IAlternativeRepository<br/><<Port>>"]
            IProgressionRepo["ğŸ“ˆ IProgressionRepository<br/><<Port>>"]
            ISwapRepo["ğŸ”€ ISwapRepository<br/><<Port>>"]
            
            %% Service Ports
            IMediaStorage["ğŸ“ IMediaStorage<br/><<Port>>"]
            ISearchService["ğŸ” ISearchService<br/><<Port>>"]
            IAnalyticsService["ğŸ“Š IAnalyticsService<br/><<Port>>"]
            IAIService["ğŸ¤– IAIService<br/><<Port>>"]
            IUserService["ğŸ‘¤ IUserService<br/><<Port>>"]
            IIdentityService["ğŸ†” IIdentityService<br/><<Port>>"]
            INotificationService["ğŸ”” INotificationService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph ExerciseAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph ExerciseRepositoryAdapters ["Repository Adapters"]
                MongoExerciseRepo["ğŸ—„ï¸ Mongo Exercise Repository<br/><<RepositoryAdapter>>"]
                MongoEquipmentRepo["ğŸ—„ï¸ Mongo Equipment Repository<br/><<RepositoryAdapter>>"]
                MongoMuscleRepo["ğŸ—„ï¸ Mongo Muscle Repository<br/><<RepositoryAdapter>>"]
                MongoAlternativeRepo["ğŸ—„ï¸ Mongo Alternative Repository<br/><<RepositoryAdapter>>"]
                MongoProgressionRepo["ğŸ—„ï¸ Mongo Progression Repository<br/><<RepositoryAdapter>>"]
                MongoSwapRepo["ğŸ—„ï¸ Mongo Swap Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph ExerciseServiceAdapters ["Service Adapters"]
                S3MediaAdapter["â˜ï¸ S3 Media Storage<br/><<StorageAdapter>>"]
                ElasticSearchAdapter["ğŸ” Elasticsearch<br/><<SearchAdapter>>"]
                MixpanelAnalyticsAdapter["ğŸ“Š Mixpanel Analytics<br/><<AnalyticsAdapter>>"]
                OpenAIAdapter["ğŸ¤– OpenAI<br/><<AIAdapter>>"]
                UserContextAdapter["ğŸ‘¤ User Context<br/><<ContextAdapter>>"]
                IdentityContextAdapter["ğŸ†” Identity Context<br/><<ContextAdapter>>"]
                FCMNotificationAdapter["ğŸ“± FCM Notification<br/><<NotificationAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph ExerciseCacheAdapters ["Cache Adapters"]
                ExerciseCache["ğŸ’¾ Exercise Cache<br/><<CacheAdapter>>"]
                SearchCache["ğŸ’¾ Search Cache<br/><<CacheAdapter>>"]
                RecommendationCache["ğŸ’¾ Recommendation Cache<br/><<CacheAdapter>>"]
                EquipmentCache["ğŸ’¾ Equipment Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph ExerciseContextBus ["Context Bus Interfaces"]
            ExerciseCommandBus["âš¡ Exercise Command Bus<br/><<CommandBus>>"]
            ExerciseQueryBus["â“ Exercise Query Bus<br/><<QueryBus>>"]
            ExerciseEventBus["ğŸ“¨ Exercise Event Bus<br/><<EventBus>>"]
        end
        
        %% ===== POLICY ENFORCEMENT =====
        subgraph ExercisePolicyLayer ["Policy Enforcement Layer"]
            ExercisePolicyEnforcementPoint["ğŸ›¡ï¸ Exercise Policy Enforcement Point<br/><<PEP>>"]
            ExerciseContentModerationService["ğŸ” Exercise Content Moderation<br/><<Moderation>>"]
            ExerciseApprovalPolicyService["âœ… Exercise Approval Policy<br/><<Policy>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph ExerciseExternal ["ğŸŒ External Systems"]
        MongoDB["ğŸ—„ï¸ MongoDB<br/><<Database>>"]
        RedisCache["ğŸ”´ Redis<br/><<Cache>>"]
        S3Bucket["â˜ï¸ S3 Bucket<br/><<Storage>>"]
        ElasticsearchCluster["ğŸ” Elasticsearch<br/><<SearchEngine>>"]
        MixpanelAPI["ğŸ“Š Mixpanel API<br/><<AnalyticsService>>"]
        OpenAIAPI["ğŸ¤– OpenAI API<br/><<AIService>>"]
        CDN["ğŸŒ CDN<br/><<ContentDelivery>>"]
        FCMService["ğŸ“± FCM Service<br/><<NotificationService>>"]
    end
    
    %% ===== EVENTS =====
    subgraph ExerciseEvents ["ğŸ“¨ Domain Events"]
        ExerciseCreatedEvent["ğŸ¯ Exercise Created<br/><<DomainEvent>>"]
        ExerciseUpdatedEvent["âœï¸ Exercise Updated<br/><<DomainEvent>>"]
        AlternativeAddedEvent["ğŸ”„ Alternative Added<br/><<DomainEvent>>"]
        ProgressionAddedEvent["ğŸ“ˆ Progression Added<br/><<DomainEvent>>"]
        ExerciseSwappedEvent["ğŸ”€ Exercise Swapped<br/><<DomainEvent>>"]
        MediaUploadedEvent["ğŸ“ Media Uploaded<br/><<DomainEvent>>"]
        EquipmentAddedEvent["ğŸ› ï¸ Equipment Added<br/><<DomainEvent>>"]
        ExerciseApprovedEvent["âœ… Exercise Approved<br/><<DomainEvent>>"]
        ExerciseFlaggedEvent["ğŸš© Exercise Flagged<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph ExerciseReadModels ["ğŸ“Š Read Models"]
        ExerciseLibraryRM["ğŸ“š Exercise Library<br/><<ReadModel>>"]
        ExerciseDetailsRM["ğŸ¯ Exercise Details<br/><<ReadModel>>"]
        EquipmentCatalogRM["ğŸ› ï¸ Equipment Catalog<br/><<ReadModel>>"]
        MuscleGroupsRM["ğŸ’ª Muscle Groups<br/><<ReadModel>>"]
        ExerciseStatsRM["ğŸ“Š Exercise Stats<br/><<ReadModel>>"]
        RecommendationsRM["ğŸ¤– Exercise Recommendations<br/><<ReadModel>>"]
        ExerciseSearchRM["ğŸ” Exercise Search<br/><<ReadModel>>"]
        PopularExercisesRM["â­ Popular Exercises<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["ğŸŒ External Contexts"]
        UserContext["ğŸ‘¤ User Context<br/><<ExternalContext>>"]
        IdentityContext["ğŸ†” Identity Context<br/><<ExternalContext>>"]
        NotificationContext["ğŸ”” Notification Context<br/><<ExternalContext>>"]
        WorkoutContext["ğŸ’ª Workout Context<br/><<ExternalContext>>"]
        ProgressionContext["ğŸ“ˆ Progression Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    ExerciseApplicationService --> ExerciseCommandBus
    ExerciseApplicationService --> ExerciseQueryBus
    ExerciseApplicationService --> ExerciseEventBus
    
    %% Commands and Queries through Application Service
    ExerciseCommands --> ExerciseApplicationService
    ExerciseQueries --> ExerciseApplicationService
    ExerciseSagas --> ExerciseApplicationService
    
    %% Application Service to Domain (orchestration)
    ExerciseApplicationService --> Exercise
    ExerciseApplicationService --> ExerciseLibrary
    ExerciseApplicationService --> ExerciseRecommendationService
    ExerciseApplicationService --> ExerciseValidationService
    ExerciseApplicationService --> ProgressionCalculationService
    ExerciseApplicationService --> ExerciseApprovalService
    
    %% Policy Enforcement Integration
    ExerciseApplicationService --> ExercisePolicyEnforcementPoint
    ExercisePolicyEnforcementPoint --> ExerciseContentModerationService
    ExercisePolicyEnforcementPoint --> ExerciseApprovalPolicyService
    
    %% Domain to Ports (Dependency Inversion)
    Exercise -->|uses| IExerciseRepo
    Exercise -->|uses| IMediaStorage
    Exercise -->|uses| ISearchService
    ExerciseLibrary -->|uses| IEquipmentRepo
    ExerciseLibrary -->|uses| IMuscleRepo
    ExerciseRecommendationService -->|uses| IAIService
    ExerciseRecommendationService -->|uses| IAnalyticsService
    ExerciseValidationService -->|uses| IUserService
    ExerciseApprovalService -->|uses| IIdentityService
    ExerciseApprovalService -->|uses| INotificationService
    
    %% Ports to Adapters (Implementation)
    IExerciseRepo -.->|implements| MongoExerciseRepo
    IEquipmentRepo -.->|implements| MongoEquipmentRepo
    IMuscleRepo -.->|implements| MongoMuscleRepo
    IAlternativeRepo -.->|implements| MongoAlternativeRepo
    IProgressionRepo -.->|implements| MongoProgressionRepo
    ISwapRepo -.->|implements| MongoSwapRepo
    IMediaStorage -.->|implements| S3MediaAdapter
    ISearchService -.->|implements| ElasticSearchAdapter
    IAnalyticsService -.->|implements| MixpanelAnalyticsAdapter
    IAIService -.->|implements| OpenAIAdapter
    IUserService -.->|implements| UserContextAdapter
    IIdentityService -.->|implements| IdentityContextAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    
    %% Adapters to External Systems
    MongoExerciseRepo -->|connects| MongoDB
    MongoEquipmentRepo -->|connects| MongoDB
    MongoMuscleRepo -->|connects| MongoDB
    MongoAlternativeRepo -->|connects| MongoDB
    MongoProgressionRepo -->|connects| MongoDB
    MongoSwapRepo -->|connects| MongoDB
    ExerciseCache -->|connects| RedisCache
    SearchCache -->|connects| RedisCache
    RecommendationCache -->|connects| RedisCache
    EquipmentCache -->|connects| RedisCache
    S3MediaAdapter -->|connects| S3Bucket
    S3MediaAdapter -->|serves via| CDN
    ElasticSearchAdapter -->|connects| ElasticsearchCluster
    MixpanelAnalyticsAdapter -->|connects| MixpanelAPI
    OpenAIAdapter -->|connects| OpenAIAPI
    FCMNotificationAdapter -->|connects| FCMService
    
    %% Cross-Context Communication
    UserContextAdapter -.->|async calls| UserContext
    IdentityContextAdapter -.->|async calls| IdentityContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    
    %% Domain Events
    Exercise -.->|publishes| ExerciseCreatedEvent
    Exercise -.->|publishes| ExerciseUpdatedEvent
    Exercise -.->|publishes| MediaUploadedEvent
    ExerciseAlternative -.->|publishes| AlternativeAddedEvent
    ExerciseProgression -.->|publishes| ProgressionAddedEvent
    ExerciseSwap -.->|publishes| ExerciseSwappedEvent
    Equipment -.->|publishes| EquipmentAddedEvent
    ExerciseApprovalService -.->|publishes| ExerciseApprovedEvent
    ExerciseApprovalService -.->|publishes| ExerciseFlaggedEvent
    
    %% Event to Read Models (via Event Bus)
    ExerciseEventBus -.->|projects to| ExerciseLibraryRM
    ExerciseEventBus -.->|projects to| ExerciseDetailsRM
    ExerciseEventBus -.->|projects to| EquipmentCatalogRM
    ExerciseEventBus -.->|projects to| MuscleGroupsRM
    ExerciseEventBus -.->|projects to| ExerciseStatsRM
    ExerciseEventBus -.->|projects to| RecommendationsRM
    ExerciseEventBus -.->|projects to| ExerciseSearchRM
    ExerciseEventBus -.->|projects to| PopularExercisesRM
    
    %% Events to Event Bus
    ExerciseCreatedEvent -.->|publishes to| ExerciseEventBus
    ExerciseUpdatedEvent -.->|publishes to| ExerciseEventBus
    AlternativeAddedEvent -.->|publishes to| ExerciseEventBus
    ProgressionAddedEvent -.->|publishes to| ExerciseEventBus
    ExerciseSwappedEvent -.->|publishes to| ExerciseEventBus
    MediaUploadedEvent -.->|publishes to| ExerciseEventBus
    EquipmentAddedEvent -.->|publishes to| ExerciseEventBus
    ExerciseApprovedEvent -.->|publishes to| ExerciseEventBus
    ExerciseFlaggedEvent -.->|publishes to| ExerciseEventBus
    
    %% Sagas listen to events
    ExerciseCreationSaga -.->|listens to| ExerciseCreatedEvent
    MediaProcessingSaga -.->|listens to| MediaUploadedEvent
    RecommendationUpdateSaga -.->|listens to| ExerciseCreatedEvent
    RecommendationUpdateSaga -.->|listens to| ExerciseUpdatedEvent
    ExerciseApprovalSaga -.->|listens to| ExerciseCreatedEvent
    ExerciseApprovalSaga -.->|listens to| ExerciseFlaggedEvent
    
    %% Context Bus to External Event Bus
    ExerciseEventBus -.->|integrates with| ExternalContexts
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef externalContext fill:#f5f5f5,stroke:#757575,stroke-width:2px,stroke-dasharray: 5 5
    classDef applicationService fill:#e3f2fd,stroke:#0277bd,stroke-width:4px
    classDef contextBus fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    
    class Exercise,ExerciseLibrary aggregate
    class ExerciseAlternative,ExerciseProgression,ExerciseSwap,ExerciseMetric,Equipment,Muscle,MuscleGroup entity
    class ExerciseId,ExerciseName,DifficultyLevel,MuscleTarget valueObject
    class IExerciseRepo,IEquipmentRepo,IMuscleRepo,IAlternativeRepo,IProgressionRepo,ISwapRepo,IMediaStorage,ISearchService,IAnalyticsService,IAIService,IUserService,IIdentityService,INotificationService port
    class MongoExerciseRepo,MongoEquipmentRepo,MongoMuscleRepo,MongoAlternativeRepo,MongoProgressionRepo,MongoSwapRepo,S3MediaAdapter,ElasticSearchAdapter,MixpanelAnalyticsAdapter,OpenAIAdapter,UserContextAdapter,IdentityContextAdapter,FCMNotificationAdapter,ExerciseCache,SearchCache,RecommendationCache,EquipmentCache adapter
    class MongoDB,RedisCache,S3Bucket,ElasticsearchCluster,MixpanelAPI,OpenAIAPI,CDN,FCMService external
    class CreateExerciseCmd,UpdateExerciseCmd,AddAlternativeCmd,AddProgressionCmd,SwapExerciseCmd,AddEquipmentCmd,UploadMediaCmd,ApproveExerciseCmd,FlagExerciseCmd command
    class GetExerciseQuery,SearchExercisesQuery,GetAlternativesQuery,GetProgressionsQuery,GetEquipmentQuery,GetMuscleGroupsQuery,RecommendExercisesQuery,GetExerciseStatsQuery query
    class ExerciseCreatedEvent,ExerciseUpdatedEvent,AlternativeAddedEvent,ProgressionAddedEvent,ExerciseSwappedEvent,MediaUploadedEvent,EquipmentAddedEvent,ExerciseApprovedEvent,ExerciseFlaggedEvent event
    class ExerciseLibraryRM,ExerciseDetailsRM,EquipmentCatalogRM,MuscleGroupsRM,ExerciseStatsRM,RecommendationsRM,ExerciseSearchRM,PopularExercisesRM readModel
    class UserContext,IdentityContext,NotificationContext,WorkoutContext,ProgressionContext externalContext
    class ExerciseApplicationService applicationService
    class ExerciseCommandBus,ExerciseQueryBus,ExerciseEventBus contextBus
    class ExercisePolicyEnforcementPoint,ExerciseContentModerationService,ExerciseApprovalPolicyService policy