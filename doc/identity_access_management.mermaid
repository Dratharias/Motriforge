graph TB
    %% ===== IDENTITY & ACCESS MANAGEMENT CONTEXT =====
    subgraph IAMContext ["ğŸ†” Identity & Access Management Context"]
        
        %% ===== APPLICATION SERVICE LAYER =====
        subgraph IAMApplicationLayer ["Application Service Layer <<Application>>"]
            IdentityApplicationService["ğŸ†” Identity Application Service<br/><<ApplicationService>>"]
            AccessApplicationService["ğŸ”’ Access Application Service<br/><<ApplicationService>>"]
            SessionApplicationService["ğŸ“‹ Session Application Service<br/><<ApplicationService>>"]
            
            %% Commands
            subgraph IAMCommands ["Commands"]
                CreateIdentityCmd["â• Create Identity<br/><<Command>>"]
                UpdateIdentityCmd["âœï¸ Update Identity<br/><<Command>>"]
                AssignRoleCmd["ğŸ­ Assign Role<br/><<Command>>"]
                GrantPermissionCmd["ğŸ”‘ Grant Permission<br/><<Command>>"]
                CreateSessionCmd["ğŸ“‹ Create Session<br/><<Command>>"]
                RefreshSessionCmd["ğŸ”„ Refresh Session<br/><<Command>>"]
                RevokeSessionCmd["âŒ Revoke Session<br/><<Command>>"]
                ValidateAccessCmd["âœ… Validate Access<br/><<Command>>"]
            end
            
            %% Queries
            subgraph IAMQueries ["Queries"]
                GetIdentityQuery["ğŸ†” Get Identity<br/><<Query>>"]
                GetPermissionsQuery["ğŸ”‘ Get Permissions<br/><<Query>>"]
                GetRolesQuery["ğŸ­ Get Roles<br/><<Query>>"]
                GetActiveSessionsQuery["ğŸ“‹ Get Active Sessions<br/><<Query>>"]
                CheckAccessQuery["âœ… Check Access<br/><<Query>>"]
                GetAccessHistoryQuery["ğŸ“œ Get Access History<br/><<Query>>"]
            end
        end
        
        %% ===== DOMAIN LAYER (HEXAGON CORE) =====
        subgraph IAMDomain ["Domain Layer <<DomainCore>>"]
            direction TB
            
            %% Aggregates
            Identity["ğŸ†” Identity<br/><<AggregateRoot>>"]
            AccessControl["ğŸ”’ Access Control<br/><<AggregateRoot>>"]
            Session["ğŸ“‹ Session<br/><<AggregateRoot>>"]
            
            %% Entities
            Role["ğŸ­ Role<br/><<Entity>>"]
            Permission["ğŸ”‘ Permission<br/><<Entity>>"]
            AccessToken["ğŸ« Access Token<br/><<Entity>>"]
            RefreshToken["ğŸ”„ Refresh Token<br/><<Entity>>"]
            Device["ğŸ“± Device<br/><<Entity>>"]
            AccessAttempt["ğŸ” Access Attempt<br/><<Entity>>"]
            
            %% Value Objects
            IdentityId["ğŸ†” Identity ID<br/><<ValueObject>>"]
            Username["ğŸ‘¤ Username<br/><<ValueObject>>"]
            RoleName["ğŸ­ Role Name<br/><<ValueObject>>"]
            PermissionName["ğŸ”‘ Permission Name<br/><<ValueObject>>"]
            SessionId["ğŸ“‹ Session ID<br/><<ValueObject>>"]
            DeviceFingerprint["ğŸ‘† Device Fingerprint<br/><<ValueObject>>"]
            IPAddress["ğŸŒ IP Address<br/><<ValueObject>>"]
            
            %% Domain Services
            IdentityManagementService["ğŸ†” Identity Management<br/><<DomainService>>"]
            AccessControlService["ğŸ”’ Access Control<br/><<DomainService>>"]
            SessionManagementService["ğŸ“‹ Session Management<br/><<DomainService>>"]
            AuthorizationService["âš–ï¸ Authorization<br/><<DomainService>>"]
            PolicyEvaluationService["ğŸ“œ Policy Evaluation<br/><<DomainService>>"]
        end
        
        %% ===== PORTS (DOMAIN INTERFACES) =====
        subgraph IAMPorts ["Ports <<Port>>"]
            direction TB
            
            %% Repository Ports
            IIdentityRepo["ğŸ†” IIdentityRepository<br/><<Port>>"]
            IAccessControlRepo["ğŸ”’ IAccessControlRepository<br/><<Port>>"]
            ISessionRepo["ğŸ“‹ ISessionRepository<br/><<Port>>"]
            IRoleRepo["ğŸ­ IRoleRepository<br/><<Port>>"]
            IPermissionRepo["ğŸ”‘ IPermissionRepository<br/><<Port>>"]
            IDeviceRepo["ğŸ“± IDeviceRepository<br/><<Port>>"]
            IAccessAttemptRepo["ğŸ” IAccessAttemptRepository<br/><<Port>>"]
            
            %% Service Ports
            ITokenGenerator["ğŸ« ITokenGenerator<br/><<Port>>"]
            ITokenValidator["âœ… ITokenValidator<br/><<Port>>"]
            IPasswordHasher["ğŸ”’ IPasswordHasher<br/><<Port>>"]
            IBiometricService["ğŸ‘† IBiometricService<br/><<Port>>"]
            IOAuth2Provider["ğŸ”— IOAuth2Provider<br/><<Port>>"]
            ISAMLProvider["ğŸ”— ISAMLProvider<br/><<Port>>"]
            ILDAPProvider["ğŸ“‹ ILDAPProvider<br/><<Port>>"]
            IAuditLogger["ğŸ“‹ IAuditLogger<br/><<Port>>"]
            INotificationService["ğŸ”” INotificationService<br/><<Port>>"]
            IRiskAssessmentService["âš ï¸ IRiskAssessmentService<br/><<Port>>"]
        end
        
        %% ===== INFRASTRUCTURE LAYER (ADAPTERS) =====
        subgraph IAMAdapters ["Infrastructure Layer <<Adapter>>"]
            direction TB
            
            %% Repository Adapters
            subgraph IAMRepositoryAdapters ["Repository Adapters"]
                MongoIdentityRepo["ğŸ—„ï¸ Mongo Identity Repository<br/><<RepositoryAdapter>>"]
                MongoAccessControlRepo["ğŸ—„ï¸ Mongo Access Control Repository<br/><<RepositoryAdapter>>"]
                RedisSessionRepo["ğŸ”´ Redis Session Repository<br/><<RepositoryAdapter>>"]
                MongoRoleRepo["ğŸ—„ï¸ Mongo Role Repository<br/><<RepositoryAdapter>>"]
                MongoPermissionRepo["ğŸ—„ï¸ Mongo Permission Repository<br/><<RepositoryAdapter>>"]
                MongoDeviceRepo["ğŸ—„ï¸ Mongo Device Repository<br/><<RepositoryAdapter>>"]
                MongoAccessAttemptRepo["ğŸ—„ï¸ Mongo Access Attempt Repository<br/><<RepositoryAdapter>>"]
            end
            
            %% Service Adapters
            subgraph IAMServiceAdapters ["Service Adapters"]
                JWTTokenAdapter["ğŸ« JWT Token Adapter<br/><<TokenAdapter>>"]
                BcryptPasswordAdapter["ğŸ”’ Bcrypt Password Adapter<br/><<SecurityAdapter>>"]
                BiometricAdapter["ğŸ‘† Biometric Adapter<br/><<BiometricAdapter>>"]
                GoogleOAuth2Adapter["ğŸ”— Google OAuth2 Adapter<br/><<OAuth2Adapter>>"]
                SAMLAdapter["ğŸ”— SAML Adapter<br/><<SAMLAdapter>>"]
                LDAPAdapter["ğŸ“‹ LDAP Adapter<br/><<LDAPAdapter>>"]
                SecurityAuditAdapter["ğŸ“‹ Security Audit Adapter<br/><<AuditAdapter>>"]
                FCMNotificationAdapter["ğŸ“± FCM Notification Adapter<br/><<NotificationAdapter>>"]
                RiskAssessmentAdapter["âš ï¸ Risk Assessment Adapter<br/><<RiskAdapter>>"]
            end
            
            %% Cache Adapters
            subgraph IAMCacheAdapters ["Cache Adapters"]
                IdentityCache["ğŸ’¾ Identity Cache<br/><<CacheAdapter>>"]
                PermissionCache["ğŸ’¾ Permission Cache<br/><<CacheAdapter>>"]
                SessionCache["ğŸ’¾ Session Cache<br/><<CacheAdapter>>"]
                RoleCache["ğŸ’¾ Role Cache<br/><<CacheAdapter>>"]
            end
        end
        
        %% ===== POLICY ENGINE =====
        subgraph PolicyEngine ["ğŸ“œ Policy Engine"]
            PolicyDecisionPoint["ğŸ¯ Policy Decision Point<br/><<PDP>>"]
            PolicyInformationPoint["ğŸ“Š Policy Information Point<br/><<PIP>>"]
            PolicyAdministrationPoint["âš™ï¸ Policy Administration Point<br/><<PAP>>"]
            PolicyRepository["ğŸ“š Policy Repository<br/><<Repository>>"]
            RuleEngine["âš™ï¸ Rule Engine<br/><<Engine>>"]
        end
        
        %% ===== CONTEXT BUS INTERFACES =====
        subgraph IAMContextBus ["Context Bus Interfaces"]
            IAMCommandBus["âš¡ IAM Command Bus<br/><<CommandBus>>"]
            IAMQueryBus["â“ IAM Query Bus<br/><<QueryBus>>"]
            IAMEventBus["ğŸ“¨ IAM Event Bus<br/><<EventBus>>"]
        end
    end
    
    %% ===== EXTERNAL SYSTEMS =====
    subgraph IAMExternal ["ğŸŒ External Systems"]
        MongoDB["ğŸ—„ï¸ MongoDB<br/><<Database>>"]
        RedisCache["ğŸ”´ Redis<br/><<Cache>>"]
        GoogleAPI["ğŸ”— Google API<br/><<OAuth2Service>>"]
        Auth0API["ğŸ”— Auth0 API<br/><<AuthService>>"]
        LDAPADS["ğŸ“‹ LDAP/AD<br/><<DirectoryService>>"]
        FCMService["ğŸ“± FCM Service<br/><<NotificationService>>"]
        HSM["ğŸ” Hardware Security Module<br/><<SecurityService>>"]
        BiometricService["ğŸ‘† Biometric Service<br/><<BiometricService>>"]
    end
    
    %% ===== EVENTS =====
    subgraph IAMEvents ["ğŸ“¨ Domain Events"]
        IdentityCreatedEvent["ğŸ†” Identity Created<br/><<DomainEvent>>"]
        IdentityUpdatedEvent["âœï¸ Identity Updated<br/><<DomainEvent>>"]
        RoleAssignedEvent["ğŸ­ Role Assigned<br/><<DomainEvent>>"]
        PermissionGrantedEvent["ğŸ”‘ Permission Granted<br/><<DomainEvent>>"]
        SessionCreatedEvent["ğŸ“‹ Session Created<br/><<DomainEvent>>"]
        SessionExpiredEvent["â° Session Expired<br/><<DomainEvent>>"]
        AccessGrantedEvent["âœ… Access Granted<br/><<DomainEvent>>"]
        AccessDeniedEvent["âŒ Access Denied<br/><<DomainEvent>>"]
        SuspiciousActivityEvent["ğŸš¨ Suspicious Activity<br/><<DomainEvent>>"]
        LoginAttemptEvent["ğŸ” Login Attempt<br/><<DomainEvent>>"]
    end
    
    %% ===== READ MODELS =====
    subgraph IAMReadModels ["ğŸ“Š Read Models"]
        IdentityProfileRM["ğŸ†” Identity Profile<br/><<ReadModel>>"]
        AccessControlDashboardRM["ğŸ”’ Access Control Dashboard<br/><<ReadModel>>"]
        ActiveSessionsRM["ğŸ“‹ Active Sessions<br/><<ReadModel>>"]
        PermissionMatrixRM["ğŸ”‘ Permission Matrix<br/><<ReadModel>>"]
        RoleHierarchyRM["ğŸ­ Role Hierarchy<br/><<ReadModel>>"]
        SecurityAuditRM["ğŸ” Security Audit<br/><<ReadModel>>"]
        AccessHistoryRM["ğŸ“œ Access History<br/><<ReadModel>>"]
        RiskAssessmentRM["âš ï¸ Risk Assessment<br/><<ReadModel>>"]
    end
    
    %% ===== EXTERNAL CONTEXT REFERENCES =====
    subgraph ExternalContexts ["ğŸŒ External Contexts"]
        UserContext["ğŸ‘¤ User Context<br/><<ExternalContext>>"]
        AuthenticationContext["ğŸ” Authentication Context<br/><<ExternalContext>>"]
        OrganizationContext["ğŸ¢ Organization Context<br/><<ExternalContext>>"]
        NotificationContext["ğŸ”” Notification Context<br/><<ExternalContext>>"]
    end
    
    %% ===== RELATIONSHIPS =====
    
    %% Application Service orchestrates everything
    IdentityApplicationService --> IAMCommandBus
    AccessApplicationService --> IAMCommandBus
    SessionApplicationService --> IAMCommandBus
    IdentityApplicationService --> IAMQueryBus
    AccessApplicationService --> IAMQueryBus
    SessionApplicationService --> IAMQueryBus
    IdentityApplicationService --> IAMEventBus
    AccessApplicationService --> IAMEventBus
    SessionApplicationService --> IAMEventBus
    
    %% Commands and Queries through Application Services
    IAMCommands --> IdentityApplicationService
    IAMCommands --> AccessApplicationService
    IAMCommands --> SessionApplicationService
    IAMQueries --> IdentityApplicationService
    IAMQueries --> AccessApplicationService
    IAMQueries --> SessionApplicationService
    
    %% Application Services to Domain (orchestration)
    IdentityApplicationService --> Identity
    IdentityApplicationService --> IdentityManagementService
    AccessApplicationService --> AccessControl
    AccessApplicationService --> AccessControlService
    AccessApplicationService --> AuthorizationService
    SessionApplicationService --> Session
    SessionApplicationService --> SessionManagementService
    
    %% Domain to Ports (Dependency Inversion)
    Identity -->|uses| IIdentityRepo
    Identity -->|uses| IPasswordHasher
    Identity -->|uses| ITokenGenerator
    AccessControl -->|uses| IAccessControlRepo
    AccessControl -->|uses| IRoleRepo
    AccessControl -->|uses| IPermissionRepo
    Session -->|uses| ISessionRepo
    Session -->|uses| ITokenValidator
    Session -->|uses| IDeviceRepo
    AuthorizationService -->|uses| IAuditLogger
    AuthorizationService -->|uses| IRiskAssessmentService
    PolicyEvaluationService -->|uses| PolicyEngine
    
    %% Policy Engine Internal Relationships
    PolicyDecisionPoint --> PolicyInformationPoint
    PolicyDecisionPoint --> RuleEngine
    PolicyInformationPoint --> PolicyRepository
    PolicyAdministrationPoint --> PolicyRepository
    
    %% Ports to Adapters (Implementation)
    IIdentityRepo -.->|implements| MongoIdentityRepo
    IAccessControlRepo -.->|implements| MongoAccessControlRepo
    ISessionRepo -.->|implements| RedisSessionRepo
    IRoleRepo -.->|implements| MongoRoleRepo
    IPermissionRepo -.->|implements| MongoPermissionRepo
    IDeviceRepo -.->|implements| MongoDeviceRepo
    IAccessAttemptRepo -.->|implements| MongoAccessAttemptRepo
    ITokenGenerator -.->|implements| JWTTokenAdapter
    ITokenValidator -.->|implements| JWTTokenAdapter
    IPasswordHasher -.->|implements| BcryptPasswordAdapter
    IBiometricService -.->|implements| BiometricAdapter
    IOAuth2Provider -.->|implements| GoogleOAuth2Adapter
    ISAMLProvider -.->|implements| SAMLAdapter
    ILDAPProvider -.->|implements| LDAPAdapter
    IAuditLogger -.->|implements| SecurityAuditAdapter
    INotificationService -.->|implements| FCMNotificationAdapter
    IRiskAssessmentService -.->|implements| RiskAssessmentAdapter
    
    %% Adapters to External Systems
    MongoIdentityRepo -->|connects| MongoDB
    MongoAccessControlRepo -->|connects| MongoDB
    MongoRoleRepo -->|connects| MongoDB
    MongoPermissionRepo -->|connects| MongoDB
    MongoDeviceRepo -->|connects| MongoDB
    MongoAccessAttemptRepo -->|connects| MongoDB
    RedisSessionRepo -->|connects| RedisCache
    IdentityCache -->|connects| RedisCache
    PermissionCache -->|connects| RedisCache
    SessionCache -->|connects| RedisCache
    RoleCache -->|connects| RedisCache
    JWTTokenAdapter -->|connects| HSM
    GoogleOAuth2Adapter -->|connects| GoogleAPI
    SAMLAdapter -->|connects| Auth0API
    LDAPAdapter -->|connects| LDAPADS
    FCMNotificationAdapter -->|connects| FCMService
    BiometricAdapter -->|connects| BiometricService
    
    %% Cross-Context Communication
    IdentityApplicationService -.->|async calls| UserContext
    AccessApplicationService -.->|async calls| AuthenticationContext
    SessionApplicationService -.->|async calls| OrganizationContext
    FCMNotificationAdapter -.->|async calls| NotificationContext
    
    %% Domain Events
    Identity -.->|publishes| IdentityCreatedEvent
    Identity -.->|publishes| IdentityUpdatedEvent
    AccessControl -.->|publishes| RoleAssignedEvent
    AccessControl -.->|publishes| PermissionGrantedEvent
    Session -.->|publishes| SessionCreatedEvent
    Session -.->|publishes| SessionExpiredEvent
    AuthorizationService -.->|publishes| AccessGrantedEvent
    AuthorizationService -.->|publishes| AccessDeniedEvent
    AuthorizationService -.->|publishes| SuspiciousActivityEvent
    AccessAttempt -.->|publishes| LoginAttemptEvent
    
    %% Event to Read Models (via Event Bus)
    IAMEventBus -.->|projects to| IdentityProfileRM
    IAMEventBus -.->|projects to| AccessControlDashboardRM
    IAMEventBus -.->|projects to| ActiveSessionsRM
    IAMEventBus -.->|projects to| PermissionMatrixRM
    IAMEventBus -.->|projects to| RoleHierarchyRM
    IAMEventBus -.->|projects to| SecurityAuditRM
    IAMEventBus -.->|projects to| AccessHistoryRM
    IAMEventBus -.->|projects to| RiskAssessmentRM
    
    %% Events to Event Bus
    IdentityCreatedEvent -.->|publishes to| IAMEventBus
    IdentityUpdatedEvent -.->|publishes to| IAMEventBus
    RoleAssignedEvent -.->|publishes to| IAMEventBus
    PermissionGrantedEvent -.->|publishes to| IAMEventBus
    SessionCreatedEvent -.->|publishes to| IAMEventBus
    SessionExpiredEvent -.->|publishes to| IAMEventBus
    AccessGrantedEvent -.->|publishes to| IAMEventBus
    AccessDeniedEvent -.->|publishes to| IAMEventBus
    SuspiciousActivityEvent -.->|publishes to| IAMEventBus
    LoginAttemptEvent -.->|publishes to| IAMEventBus
    
    %% Context Bus to External Event Bus
    IAMEventBus -.->|integrates with| ExternalContexts
    
    %% Policy Engine Integration
    AuthorizationService --> PolicyDecisionPoint
    PolicyDecisionPoint --> AccessControlService
    
    %% ===== STYLING =====
    classDef aggregate fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef entity fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef valueObject fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef port fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef adapter fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef external fill:#fafafa,stroke:#424242,stroke-width:2px
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef query fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef event fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef readModel fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef externalContext fill:#f5f5f5,stroke:#757575,stroke-width:2px,stroke-dasharray: 5 5
    classDef applicationService fill:#e3f2fd,stroke:#0277bd,stroke-width:4px
    classDef contextBus fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef policy fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    
    class Identity,AccessControl,Session aggregate
    class Role,Permission,AccessToken,RefreshToken,Device,AccessAttempt entity
    class IdentityId,Username,RoleName,PermissionName,SessionId,DeviceFingerprint,IPAddress valueObject
    class IIdentityRepo,IAccessControlRepo,ISessionRepo,IRoleRepo,IPermissionRepo,IDeviceRepo,IAccessAttemptRepo,ITokenGenerator,ITokenValidator,IPasswordHasher,IBiometricService,IOAuth2Provider,ISAMLProvider,ILDAPProvider,IAuditLogger,INotificationService,IRiskAssessmentService port
    class MongoIdentityRepo,MongoAccessControlRepo,RedisSessionRepo,MongoRoleRepo,MongoPermissionRepo,MongoDeviceRepo,MongoAccessAttemptRepo,JWTTokenAdapter,BcryptPasswordAdapter,BiometricAdapter,GoogleOAuth2Adapter,SAMLAdapter,LDAPAdapter,SecurityAuditAdapter,FCMNotificationAdapter,RiskAssessmentAdapter,IdentityCache,PermissionCache,SessionCache,RoleCache adapter
    class MongoDB,RedisCache,GoogleAPI,Auth0API,LDAPADS,FCMService,HSM,BiometricService external
    class CreateIdentityCmd,UpdateIdentityCmd,AssignRoleCmd,GrantPermissionCmd,CreateSessionCmd,RefreshSessionCmd,RevokeSessionCmd,ValidateAccessCmd command
    class GetIdentityQuery,GetPermissionsQuery,GetRolesQuery,GetActiveSessionsQuery,CheckAccessQuery,GetAccessHistoryQuery query
    class IdentityCreatedEvent,IdentityUpdatedEvent,RoleAssignedEvent,PermissionGrantedEvent,SessionCreatedEvent,SessionExpiredEvent,AccessGrantedEvent,AccessDeniedEvent,SuspiciousActivityEvent,LoginAttemptEvent event
    class IdentityProfileRM,AccessControlDashboardRM,ActiveSessionsRM,PermissionMatrixRM,RoleHierarchyRM,SecurityAuditRM,AccessHistoryRM,RiskAssessmentRM readModel
    class UserContext,AuthenticationContext,OrganizationContext,NotificationContext externalContext
    class IdentityApplicationService,AccessApplicationService,SessionApplicationService applicationService
    class IAMCommandBus,IAMQueryBus,IAMEventBus contextBus
    class PolicyDecisionPoint,PolicyInformationPoint,PolicyAdministrationPoint,PolicyRepository,RuleEngine policy