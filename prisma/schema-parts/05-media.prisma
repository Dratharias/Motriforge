// =====================================
// MEDIA MANAGEMENT
// =====================================

model MediaType {
  id               String   @id @default(cuid())
  name             String   @unique @db.VarChar(50)
  description      String?  @db.Text
  allowedMimeTypes Json     @map("allowed_mime_types") // JSON array of strings
  maxFileSizeBytes BigInt   @map("max_file_size_bytes")
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  createdBy        String   @map("created_by")

  // Relations
  createdByUser User    @relation("MediaTypeCreatedBy", fields: [createdBy], references: [id])
  media         Media[]

  @@map("media_type")
}

model Media {
  id            String   @id @default(cuid())
  filename      String   @db.VarChar(255)
  url           String   @unique @db.Text
  mediaTypeId   String   @map("media_type_id")
  mimeType      String   @map("mime_type") @db.VarChar(100)
  fileSizeBytes BigInt   @map("file_size_bytes")
  fileHash      String?  @map("file_hash") @db.VarChar(64)
  visibilityId  String   @map("visibility_id")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  createdBy     String   @map("created_by")

  // Relations
  mediaType     MediaType        @relation(fields: [mediaTypeId], references: [id])
  visibility    Visibility       @relation(fields: [visibilityId], references: [id])
  createdByUser User             @relation("MediaCreatedBy", fields: [createdBy], references: [id])
  tags          MediaTag[]
  metadata      MediaMetadata?
  exercises     ExerciseMedia[]
  workouts      WorkoutMedia[]
  programs      ProgramMedia[]
  equipment     EquipmentMedia[]

  @@map("media")
}

model MediaTag {
  mediaId   String   @map("media_id")
  tagId     String   @map("tag_id")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  createdBy String   @map("created_by")

  // Relations
  media         Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)
  tag           Tag   @relation(fields: [tagId], references: [id])
  createdByUser User  @relation("MediaTagCreatedBy", fields: [createdBy], references: [id])

  @@id([mediaId, tagId])
  @@map("media_tag")
}

model MediaMetadata {
  id              String   @id @default(cuid())
  mediaId         String   @unique @map("media_id")
  metadata        Json // JSON object for flexible metadata
  widthPixels     Int?     @map("width_pixels") @db.SmallInt
  heightPixels    Int?     @map("height_pixels") @db.SmallInt
  durationSeconds Int?     @map("duration_seconds") @db.SmallInt
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  createdBy       String   @map("created_by")

  // Relations
  media         Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)
  createdByUser User  @relation("MediaMetadataCreatedBy", fields: [createdBy], references: [id])

  @@map("media_metadata")
}

model ExerciseMedia {
  exerciseId String   @map("exercise_id")
  mediaId    String   @map("media_id")
  purpose    String   @db.VarChar(50) // TODO: Convert to enum (THUMBNAIL, INSTRUCTION, DEMO)
  orderIndex Int      @default(0) @map("order_index") @db.SmallInt
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  createdBy  String   @map("created_by")

  // Relations
  exercise      Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  media         Media    @relation(fields: [mediaId], references: [id])
  createdByUser User     @relation("ExerciseMediaCreatedBy", fields: [createdBy], references: [id])

  @@id([exerciseId, mediaId])
  @@map("exercise_media")
}

model EquipmentMedia {
  equipmentId String   @map("equipment_id")
  mediaId     String   @map("media_id")
  purpose     String   @db.VarChar(50) // TODO: Convert to enum
  orderIndex  Int      @default(0) @map("order_index") @db.SmallInt
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  createdBy   String   @map("created_by")

  // Relations
  equipment     Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  media         Media     @relation(fields: [mediaId], references: [id])
  createdByUser User      @relation("EquipmentMediaCreatedBy", fields: [createdBy], references: [id])

  @@id([equipmentId, mediaId])
  @@map("equipment_media")
}
